

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>app.pages.QC_and_data_analysis &mdash; ProteoGyver Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=aaadad1f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ProteoGyver
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">Proteogyver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Proteomics_example.html">Example Proteomics usecase for ProteoGyver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Interactomics_example.html">Example Interactomcis usecase for ProteoGyver using a public dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_guide.html">ProteoGyver User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/modules.html">Code Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ProteoGyver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">app.pages.QC_and_data_analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for app.pages.QC_and_data_analysis</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Restructured frontend for proteogyver app.</span>

<span class="sd">This module contains the main frontend logic for the Proteogyver application,</span>
<span class="sd">including callbacks for data processing, analysis, and visualization.</span>

<span class="sd">Attributes:</span>
<span class="sd">    parameters (dict): Application parameters loaded from parameters.toml</span>
<span class="sd">    db_file (str): Path to the database file</span>
<span class="sd">    contaminant_list (list): List of contaminant proteins</span>
<span class="sd">    figure_output_formats (list): Supported figure export formats</span>
<span class="sd">    layout (html.Div): Main application layout</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xxlimited</span><span class="w"> </span><span class="kn">import</span> <span class="n">Str</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dash</span><span class="w"> </span><span class="kn">import</span> <span class="n">html</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">register_page</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dash.dependencies</span><span class="w"> </span><span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">State</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components</span><span class="w"> </span><span class="kn">import</span> <span class="n">ui_components</span> <span class="k">as</span> <span class="n">ui</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components</span><span class="w"> </span><span class="kn">import</span> <span class="n">infra</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components</span><span class="w"> </span><span class="kn">import</span> <span class="n">parsing</span><span class="p">,</span> <span class="n">qc_analysis</span><span class="p">,</span> <span class="n">proteomics</span><span class="p">,</span> <span class="n">interactomics</span><span class="p">,</span> <span class="n">db_functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components.figures.color_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_assigned_colors</span><span class="p">,</span> <span class="n">remove_unwanted_colors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components.figures</span><span class="w"> </span><span class="kn">import</span> <span class="n">tic_graph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">components.api_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">biogrid</span><span class="p">,</span> <span class="n">intact</span><span class="p">,</span> <span class="n">uniprot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">element_styles</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONTENT_STYLE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.error</span><span class="w"> </span><span class="kn">import</span> <span class="n">URLError</span><span class="p">,</span> <span class="n">HTTPError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">_version</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span>


<span class="n">register_page</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loading&#39;</span><span class="p">)</span>

<span class="n">root_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">parameters_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span><span class="s1">&#39;parameters.toml&#39;</span><span class="p">)</span>
<span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">parse_parameters</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">parameters_file</span><span class="p">))</span>
<span class="n">db_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Data paths&#39;</span><span class="p">][</span><span class="s1">&#39;Database file&#39;</span><span class="p">])</span>
<span class="n">contaminant_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_functions</span><span class="o">.</span><span class="n">get_contaminants</span><span class="p">(</span><span class="n">db_file</span><span class="p">)</span>
<span class="n">figure_output_formats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">]</span>

<span class="n">layout</span><span class="p">:</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">main_sidebar</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Possible values&#39;</span><span class="p">][</span><span class="s1">&#39;Figure templates&#39;</span><span class="p">],</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Possible values&#39;</span><span class="p">][</span><span class="s1">&#39;Implemented workflows&#39;</span><span class="p">]),</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">modals</span><span class="p">(),</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">main_content_div</span><span class="p">(),</span>
        <span class="n">infra</span><span class="o">.</span><span class="n">invisible_utilities</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">style</span><span class="o">=</span><span class="n">CONTENT_STYLE</span>
<span class="p">)</span>

<div class="viewcode-block" id="get_github_version">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.get_github_version">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_github_version</span><span class="p">(</span><span class="n">repo_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/varjolab/Proteogyver&quot;</span><span class="p">,</span> <span class="n">branch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch the version from the VERSION file in a GitHub repository.</span>
<span class="sd">    </span>
<span class="sd">    :param repo_url: GitHub repository URL.</span>
<span class="sd">    :param branch: Branch name to fetch from (default: &#39;main&#39;).</span>
<span class="sd">    :returns: Version string from GitHub, or None if fetch fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert GitHub URL to raw content URL</span>
    <span class="c1"># https://github.com/varjolab/Proteogyver -&gt; https://raw.githubusercontent.com/varjolab/Proteogyver/main/VERSION</span>
    <span class="n">raw_url</span> <span class="o">=</span> <span class="n">repo_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;github.com&quot;</span><span class="p">,</span> <span class="s2">&quot;raw.githubusercontent.com&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">branch</span><span class="si">}</span><span class="s2">/VERSION&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">raw_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">version</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">URLError</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Use logging module directly since logger might not be initialized yet</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch version from GitHub: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch version from GitHub: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="version_check">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.version_check">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;version-check-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteogyver-logo&#39;</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">version_check</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a version check div, which will be shown if there is a newer version available.</span>
<span class="sd">    </span>
<span class="sd">    :param _: trigger for the callback.</span>
<span class="sd">    :returns: Version check div with update notification if newer version is available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">available_version</span> <span class="o">=</span> <span class="n">get_github_version</span><span class="p">()</span>
    <span class="n">div_contents</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">compstyle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;12px&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">available_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Could not fetch version, don&#39;t show anything</span>
        <span class="n">div_contents</span> <span class="o">=</span> <span class="s1">&#39;Could not check for new version.&#39;</span>
    <span class="k">elif</span> <span class="n">available_version</span> <span class="o">!=</span> <span class="n">__version__</span><span class="p">:</span>
        <span class="c1"># Newer version available</span>
        <span class="n">div_contents</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;New version available: </span><span class="si">{</span><span class="n">available_version</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s1">)&#39;</span>    
        <span class="n">compstyle</span><span class="p">[</span><span class="s1">&#39;font-size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;20px&#39;</span>
    <span class="k">return</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">div_contents</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">compstyle</span><span class="p">)</span></div>



<div class="viewcode-block" id="clear_data_stores">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.clear_data_stores">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="c1">#  Output(&#39;workflow-stores&#39;, &#39;children&#39;),</span>
    <span class="c1"># Output({&#39;type&#39;: &#39;data-store&#39;, &#39;name&#39;: ALL}, &#39;clear_data&#39;),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;start-analysis-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;version-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;begin-analysis-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="c1">#TODO: implement clearing.</span>
<span class="c1">#TODO: Alternatively we could load the data store elements at this point, except for the ones needed to ingest files up to this point.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_data_stores</span><span class="p">(</span><span class="n">begin_clicks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all data stores before analysis begins. Also saves version information to the version data store.</span>

<span class="sd">    :param begin_clicks: Number of clicks on the begin analysis button.</span>
<span class="sd">    :returns: Tuple of (empty string to clear notification, version dictionary).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">version_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Proteogyver version&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">update_type</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">db_functions</span><span class="o">.</span><span class="n">get_database_versions</span><span class="p">(</span><span class="n">db_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">version_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Database: </span><span class="si">{</span><span class="n">update_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">db_functions</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">db_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">db_functions</span><span class="o">.</span><span class="n">get_full_table_as_pd</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s1">&#39;data_versions&#39;</span><span class="p">):</span>
            <span class="n">version_dict</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error getting external versions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># type: ignore</span>

    <span class="n">version_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">version_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Entity&#39;</span><span class="p">,</span> <span class="s1">&#39;Version&#39;</span><span class="p">])</span>
    
    <span class="c1">#logger.info(</span>
    <span class="c1">#    f&#39;Data cleared. Start clicks: {begin_clicks}: {datetime.now()}&#39;)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version_df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="handle_uploaded_data_table">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.handle_uploaded_data_table">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;upload-data-file-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-table-info-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-table-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;input-warnings-data-table-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;input-warnings-data-table-div&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;upload-data-file&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;upload-data-file&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;upload-data-file&#39;</span><span class="p">,</span> <span class="s1">&#39;last_modified&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;upload-data-file-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_uploaded_data_table</span><span class="p">(</span>
    <span class="n">file_contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">mod_date</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
    <span class="n">current_upload_style</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse uploaded data table and populate stores.</span>

<span class="sd">    :param file_contents: Uploaded file contents.</span>
<span class="sd">    :param file_name: Uploaded filename.</span>
<span class="sd">    :param mod_date: File modification timestamp.</span>
<span class="sd">    :param current_upload_style: Upload success indicator style.</span>
<span class="sd">    :returns: Tuple of (upload style, data table info, data table contents, warnings, hide_warnings).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_contents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">upload_style</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">warning_list</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">parse_data_file</span><span class="p">(</span>
            <span class="n">file_contents</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">mod_date</span><span class="p">,</span> <span class="n">current_upload_style</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;file loading&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">warning_list</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;Data table warnings&#39;</span><span class="p">))</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;This might be due to file format. Supported formats are: csv (comma separated); tsv, txt, tab (tab separated); xlsx, xls (excel)&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">upload_style</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
    <span class="k">return</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span></div>



<div class="viewcode-block" id="handle_uploaded_sample_table">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.handle_uploaded_sample_table">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;upload-sample_table-file-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-sample-table-info-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-sample-table-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;input-warnings-sample-table-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;input-warnings-sample-table-div&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;upload-sample_table-file&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;upload-sample_table-file&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;upload-sample_table-file&#39;</span><span class="p">,</span> <span class="s1">&#39;last_modified&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;upload-sample_table-file-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_uploaded_sample_table</span><span class="p">(</span>
    <span class="n">file_contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mod_date</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">current_upload_style</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse uploaded sample table and populate stores.</span>

<span class="sd">    :param file_contents: Uploaded file contents.</span>
<span class="sd">    :param file_name: Uploaded filename.</span>
<span class="sd">    :param mod_date: File modification timestamp.</span>
<span class="sd">    :param current_upload_style: Upload success indicator style.</span>
<span class="sd">    :returns: Tuple of (upload style, sample table info, sample table contents, warnings, hide_warnings).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_contents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">upload_style</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">table_data</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">parse_sample_table</span><span class="p">(</span><span class="n">file_contents</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">mod_date</span><span class="p">,</span> <span class="n">current_upload_style</span><span class="p">)</span>
        <span class="n">exp_cols_found</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;required columns found&#39;</span><span class="p">]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp_cols_found</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">req_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sample name&#39;</span><span class="p">,</span> <span class="s1">&#39;sample group&#39;</span><span class="p">]</span>
            <span class="n">fcols</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">info</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">req_cols</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">info</span><span class="p">])</span>
            <span class="n">warnings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s1">&#39;Sample table warnings&#39;</span><span class="p">),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;- Experimental design table is missing required columns. Found columns: </span><span class="si">{</span><span class="n">fcols</span><span class="si">}</span><span class="s1">, required columns: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">req_cols</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span>
                <span class="p">),</span>
                <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s1">&#39;This might be due to file format. Supported formats are: csv (comma separated); tsv, txt, tab (tab separated); xlsx, xls (excel)&#39;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">upload_style</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">table_data</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
    <span class="k">return</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span></div>



<div class="viewcode-block" id="validate_data">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.validate_data">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span>
           <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;button-download-all-data&#39;</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;start-analysis-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-table-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-table-info-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-sample-table-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-sample-table-info-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;figure-theme-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;sidebar-options&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_data</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_tables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">data_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">expdes_table</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">expdes_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">figure_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">additional_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate and format uploaded data for analysis.</span>

<span class="sd">    :param _: Placeholder for start analysis notifier.</span>
<span class="sd">    :param data_tables: Uploaded data tables.</span>
<span class="sd">    :param data_info: Info about uploaded data tables.</span>
<span class="sd">    :param expdes_table: Experimental design table.</span>
<span class="sd">    :param expdes_info: Info about experimental design.</span>
<span class="sd">    :param figure_template: Selected figure template.</span>
<span class="sd">    :param additional_options: Selected additional processing options.</span>
<span class="sd">    :returns: Tuple of (data_dict, disable_download, warnings, hide_warnings).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Validating data: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cont</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">repnames</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">uniq_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">additional_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;Remove common contaminants&#39;</span> <span class="ow">in</span> <span class="n">additional_options</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">contaminant_list</span>
        <span class="k">if</span> <span class="s1">&#39;Rename replicates&#39;</span> <span class="ow">in</span> <span class="n">additional_options</span><span class="p">:</span>
            <span class="n">repnames</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;Use unique proteins only (remove protein groups)&#39;</span> <span class="ow">in</span> <span class="n">additional_options</span><span class="p">:</span>
            <span class="n">uniq_only</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pio</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">remove_unwanted_colors</span><span class="p">(</span><span class="n">figure_template</span><span class="p">)</span>
    <span class="n">data_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">format_data</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%H-%M-%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">data_tables</span><span class="p">,</span>
        <span class="n">data_info</span><span class="p">,</span>
        <span class="n">expdes_table</span><span class="p">,</span>
        <span class="n">expdes_info</span><span class="p">,</span>
        <span class="n">cont</span><span class="p">,</span>
        <span class="n">repnames</span><span class="p">,</span>
        <span class="n">uniq_only</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;workflow parameters&#39;</span><span class="p">][</span><span class="s1">&#39;interactomics&#39;</span><span class="p">][</span><span class="s1">&#39;control indicators&#39;</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;file loading&#39;</span><span class="p">][</span><span class="s1">&#39;Bait ID column names&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">data_dict</span><span class="p">,</span>
        <span class="kc">False</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="remove_samples">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.remove_samples">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span>
           <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;discard-samples-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_samples</span><span class="p">(</span>
    <span class="n">discard_samples_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove selected samples from the data dictionary.</span>

<span class="sd">    :param discard_samples_list: Sample names to remove.</span>
<span class="sd">    :param data_dictionary: Current data dictionary.</span>
<span class="sd">    :returns: Updated data dictionary without the selected samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parsing</span><span class="o">.</span><span class="n">delete_samples</span><span class="p">(</span><span class="n">discard_samples_list</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_qc_area">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.create_qc_area">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-analysis-area&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;discard-samples-div&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-specific-input-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span><span class="n">allow_duplicate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-specific-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span><span class="n">allow_duplicate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_qc_area</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the quality control area and show the discard button.</span>

<span class="sd">    :param _: Placeholder for replicate colors data store.</span>
<span class="sd">    :returns: Tuple of (QC area, discard button hidden flag, workflow input, workflow div).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ui</span><span class="o">.</span><span class="n">qc_area</span><span class="p">(),</span> <span class="kc">False</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="assign_replicate_colors">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.assign_replicate_colors">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-with-contaminants-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assign_replicate_colors</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign colors to sample replicates for visualization.</span>

<span class="sd">    :param data_dictionary: Data dictionary with sample groups.</span>
<span class="sd">    :returns: Tuple of (colors for samples, colors incl. contaminants).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_assigned_colors</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">])</span></div>



<div class="viewcode-block" id="check_inputs">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.check_inputs">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;begin-analysis-button&#39;</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-table-info-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;uploaded-sample-table-info-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;workflow-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> 
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;figure-theme-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;upload-data-file-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span> 
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;upload-sample_table-file-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_inputs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that all required inputs are present before analysis.</span>

<span class="sd">    Returns True if inputs are invalid, to directly control the disabled state</span>
<span class="sd">    of the &quot;Begin analysis&quot; button.</span>

<span class="sd">    :param args: Data table info, sample table info, selected workflow, selected</span>
<span class="sd">        figure theme, and upload success styles.</span>
<span class="sd">    :returns: True if inputs are invalid, False if valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parsing</span><span class="o">.</span><span class="n">validate_basic_inputs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>



<div class="viewcode-block" id="open_discard_samples_modal">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.open_discard_samples_modal">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;discard-sample-checklist-container&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;discard-samples-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;count-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">open_discard_samples_modal</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
    <span class="n">count_plot</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create modal contents for selecting samples to discard.</span>

<span class="sd">    :param _: Number of clicks on discard samples button.</span>
<span class="sd">    :param count_plot: Current count plot components.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :returns: Checklist UI components for sample selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">discard_samples_checklist</span><span class="p">(</span>
        <span class="n">count_plot</span><span class="p">,</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="toggle_discard_modal">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.toggle_discard_modal">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;discard-samples-modal&#39;</span><span class="p">,</span> <span class="s1">&#39;is_open&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;discard-samples-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;done-discarding-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;discard-samples-modal&#39;</span><span class="p">,</span> <span class="s1">&#39;is_open&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">toggle_discard_modal</span><span class="p">(</span><span class="n">n1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">n2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">is_open</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Toggle visibility of the discard samples modal dialog.</span>

<span class="sd">    :param n1: Clicks on discard samples button.</span>
<span class="sd">    :param n2: Clicks on done discarding button.</span>
<span class="sd">    :param is_open: Current modal visibility state.</span>
<span class="sd">    :returns: New modal visibility state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">is_open</span>
    <span class="k">return</span> <span class="n">is_open</span></div>



<div class="viewcode-block" id="add_samples_to_discarded">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.add_samples_to_discarded">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;discard-samples-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;done-discarding-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;checklist-select-samples-to-discard&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_samples_to_discarded</span><span class="p">(</span><span class="n">n_clicks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">chosen_samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add selected samples to the list of discarded samples.</span>

<span class="sd">    :param n_clicks: Number of clicks on done discarding button.</span>
<span class="sd">    :param chosen_samples: Sample names selected for discarding.</span>
<span class="sd">    :returns: Updated list of discarded samples, or no_update if not triggered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_clicks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">if</span> <span class="n">n_clicks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">return</span> <span class="n">chosen_samples</span></div>



<div class="viewcode-block" id="parse_chromatogram_data">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.parse_chromatogram_data">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;tic-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tic-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;qc-area&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_chromatogram_data</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate chromatogram plot data from sample information.</span>

<span class="sd">    :param _: Trigger placeholder from QC area.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (TIC plot components, TIC data for storage).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">parse_tic_data</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;experimental design&#39;</span><span class="p">],</span>
        <span class="n">replicate_colors</span><span class="p">,</span>
        <span class="n">db_file</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="plot_tic">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.plot_tic">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;qc-tic-plot&#39;</span><span class="p">,</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tic-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;qc-tic-dropdown&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="p">)</span> 
<span class="k">def</span><span class="w"> </span><span class="nf">plot_tic</span><span class="p">(</span><span class="n">chromatogram_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">graph_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a chromatogram plot figure.</span>

<span class="sd">    :param chromatogram_data: Processed chromatogram data.</span>
<span class="sd">    :param graph_type: Type of chromatogram graph to display.</span>
<span class="sd">    :returns: Plotly Figure for the chromatogram plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">tic_graph</span><span class="o">.</span><span class="n">tic_figure</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span> <span class="n">chromatogram_data</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="count_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.count_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;count-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;count-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;tic-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-with-contaminants-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">count_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate protein count plot for samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param replicate_colors: Color assignments for samples including contaminants.</span>
<span class="sd">    :returns: Tuple of (count plot components, count data for storage).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">count_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;with-contaminants&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">replicate_colors</span><span class="p">,</span>
        <span class="n">contaminant_list</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="common_proteins_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.common_proteins_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;common-protein-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;common-protein-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;count-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">common_proteins_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate plot showing common proteins across samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :returns: Tuple of (common proteins plot components, common proteins data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">common_proteins</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">db_file</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="n">additional_groups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Other contaminants&#39;</span><span class="p">:</span> <span class="n">contaminant_list</span>
        <span class="p">},</span>
        <span class="n">id_str</span> <span class="o">=</span> <span class="s1">&#39;qc&#39;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="coverage_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.coverage_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;coverage-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;coverage-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;common-protein-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">coverage_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate protein coverage plot across samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :returns: Tuple of (coverage plot components, coverage data for storage).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">coverage_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="reproducibility_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.reproducibility_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;reproducibility-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;reproducibility-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;coverage-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reproducibility_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate reproducibility plot between sample replicates.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :returns: Tuple of (reproducibility plot components, reproducibility data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">reproducibility_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="missing_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.missing_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;missing-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;missing-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;reproducibility-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">missing_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate missing values plot across samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (missing values plot components, missing values data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">missing_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">replicate_colors</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="sum_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.sum_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;sum-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sum-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;missing-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sum_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate plot showing sum of intensities across samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (sum plot components, sum data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">sum_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">replicate_colors</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="mean_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.mean_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;mean-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mean-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;sum-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mean_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate plot showing mean intensities across samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (mean plot components, mean data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">mean_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">replicate_colors</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="distribution_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.distribution_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;distribution-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span> 
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;distribution-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;mean-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> 
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">distribution_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate plot showing distribution of intensities across samples.</span>

<span class="sd">    :param _: Trigger placeholder from upstream callback.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (distribution plot components, distribution data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">distribution_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">replicate_colors</span><span class="p">,</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;rev&#39;</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="n">parsing</span><span class="o">.</span><span class="n">get_distribution_title</span><span class="p">(</span>
            <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">])</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="pass_selected_groups_to_data_store">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.pass_selected_groups_to_data_store">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-commonality-plot-visible-groups-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;qc-commonality-plot-update-plot-button&#39;</span><span class="p">,</span><span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;qc-commonality-select-visible-sample-groups&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pass_selected_groups_to_data_store</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
    <span class="n">selection</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store selected sample groups for commonality plot visibility.</span>

<span class="sd">    :param _: Clicks on update plot button.</span>
<span class="sd">    :param selection: Selected sample groups.</span>
<span class="sd">    :returns: Dict with selected groups for visibility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="n">selection</span><span class="p">}</span></div>


<div class="viewcode-block" id="generate_commonality_container">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.generate_commonality_container">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;commonality-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_commonality_container</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate container for the commonality plot.</span>

<span class="sd">    :param data_dictionary: Data dictionary containing sample group information.</span>
<span class="sd">    :returns: Div container for commonality plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample_groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">generate_commonality_container</span><span class="p">(</span><span class="n">sample_groups</span><span class="p">)</span></div>


<div class="viewcode-block" id="commonality_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.commonality_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;qc-commonality-graph-div&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;commonality-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;commonality-figure-pdf-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;toggle-additional-supervenn-options&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-commonality-plot-visible-groups-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">commonality_plot</span><span class="p">(</span>
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">additional_options</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">show_only_groups</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a commonality plot showing protein overlap between groups.</span>

<span class="sd">    :param data_dictionary: Data dictionary containing sample information.</span>
<span class="sd">    :param additional_options: Selected additional plot options.</span>
<span class="sd">    :param show_only_groups: Optional dict specifying groups to display.</span>
<span class="sd">    :returns: Tuple of (plot components, plot data, PDF data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">show_groups</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">show_only_groups</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">show_groups</span> <span class="o">=</span> <span class="n">show_only_groups</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">show_groups</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">commonality_plot</span><span class="p">(</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;table to use&#39;</span><span class="p">]],</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;rev&#39;</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="p">(</span><span class="s1">&#39;Use supervenn&#39;</span> <span class="ow">in</span> <span class="n">additional_options</span><span class="p">),</span> <span class="n">only_groups</span><span class="o">=</span><span class="n">show_groups</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="qc_done">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.qc_done">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;qc-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qc-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;distribution-plot-div&#39;</span><span class="p">},</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">qc_done</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Notify that QC analysis is complete.</span>

<span class="sd">    :param _: Trigger placeholder from distribution plot.</span>
<span class="sd">    :returns: Empty string to trigger completion notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="proteomics_filtering_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_filtering_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-na-filtered-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-na-filtered-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-run-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;proteomics-filter-minimum-percentage&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;proteomics-filter-type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_filtering_plot</span><span class="p">(</span><span class="n">nclicks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">uploaded_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">filtering_percentage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create NA filtering results plot in proteomics workflow.</span>

<span class="sd">    :param nclicks: Number of clicks on run button.</span>
<span class="sd">    :param uploaded_data: Data dictionary containing proteomics data.</span>
<span class="sd">    :param filtering_percentage: Minimum percentage threshold for filtering.</span>
<span class="sd">    :param filter_type: Filter type (&#39;sample-group&#39; or &#39;sample-set&#39;).</span>
<span class="sd">    :returns: Tuple of (plot components, filtered data) or (no_update, no_update).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nclicks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nclicks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">na_filter</span><span class="p">(</span><span class="n">uploaded_data</span><span class="p">,</span> <span class="n">filtering_percentage</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span> <span class="n">filter_type</span><span class="o">=</span><span class="n">filter_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="proteomics_normalization_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_normalization_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-normalization-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-normalization-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-na-filtered-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-normalization-radio-option&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_normalization_plot</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">normalization_option</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create normalization results plot in proteomics workflow.</span>

<span class="sd">    :param filtered_data: NA-filtered proteomics data with intensities and metadata.</span>
<span class="sd">    :param normalization_option: Normalization method (e.g., &#39;median&#39;, &#39;quantile&#39;, &#39;vsn&#39;).</span>
<span class="sd">    :returns: Tuple of (plot components, normalized data) or no_update if no input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filtered_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">normalization</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">,</span> <span class="n">normalization_option</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Config&#39;</span><span class="p">][</span><span class="s1">&#39;script error file&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="proteomics_missing_in_other_samples">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_missing_in_other_samples">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-missing-in-other-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-normalization-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_missing_in_other_samples</span><span class="p">(</span><span class="n">normalized_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create plot showing missing values patterns after normalization.</span>

<span class="sd">    :param normalized_data: Normalized proteomics data with intensities and metadata.</span>
<span class="sd">    :returns: Div with plot components (half-height figure).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">missing_values_in_other_samples</span><span class="p">(</span><span class="n">normalized_data</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="proteomics_imputation_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_imputation_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-imputation-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-imputation-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-normalization-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-imputation-radio-option&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_imputation_plot</span><span class="p">(</span><span class="n">normalized_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">imputation_option</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create imputation results plot in proteomics workflow.</span>

<span class="sd">    :param normalized_data: Normalized proteomics data.</span>
<span class="sd">    :param imputation_option: Imputation method (e.g., &#39;minprob&#39;, &#39;minvalue&#39;, &#39;gaussian&#39;, &#39;qrilc&#39;, &#39;random_forest&#39;).</span>
<span class="sd">    :param data_dictionary: Full data dictionary (for sample group metadata).</span>
<span class="sd">    :returns: Tuple of (plot components, imputed data) or no_update if no input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">normalized_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">imputation</span><span class="p">(</span>
        <span class="n">normalized_data</span><span class="p">,</span>
        <span class="n">imputation_option</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Config&#39;</span><span class="p">][</span><span class="s1">&#39;script error file&#39;</span><span class="p">],</span>
        <span class="n">sample_groups_rev</span><span class="o">=</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span>
        <span class="p">)</span></div>




<div class="viewcode-block" id="proteomics_cv_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_cv_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-cv-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-cv-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-na-filtered-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_cv_plot</span><span class="p">(</span><span class="n">uploaded_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">na_filtered_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">upload_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create coefficient of variation (CV) plot for proteomics data.</span>

<span class="sd">    :param uploaded_data: Original uploaded data dictionary with raw intensities.</span>
<span class="sd">    :param na_filtered_data: NA-filtered proteomics data for filtering raw data.</span>
<span class="sd">    :param upload_dict: Main data dictionary with sample grouping.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (CV plot components, CV analysis data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">perc_cvplot</span><span class="p">(</span><span class="n">uploaded_data</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;raw intensity&#39;</span><span class="p">],</span> <span class="n">na_filtered_data</span><span class="p">,</span> <span class="n">upload_dict</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="proteomics_pca_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_pca_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-pca-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-pca-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-imputation-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_pca_plot</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">upload_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create PCA plot for proteomics data.</span>

<span class="sd">    :param imputed_data: Imputed proteomics data for PCA analysis.</span>
<span class="sd">    :param upload_dict: Data dictionary with sample grouping information.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (PCA plot components, PCA analysis data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">,</span> <span class="n">upload_dict</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;rev&#39;</span><span class="p">],</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">)</span></div>


<div class="viewcode-block" id="proteomics_clustermap">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_clustermap">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-clustermap-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-clustermap-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;done-notifier&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-clustering-done-notifier&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-imputation-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_clustermap</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create hierarchical clustering clustermap for proteomics data.</span>

<span class="sd">    :param imputed_data: Imputed proteomics data for clustering analysis.</span>
<span class="sd">    :returns: Tuple of (clustermap components, clustering data, completion notifier).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,)</span></div>


<div class="viewcode-block" id="proteomics_check_comparison_table">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_check_comparison_table">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;proteomics-comparison-table-upload-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-comparison-table-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-comparison-table-upload&#39;</span><span class="p">,</span> <span class="s1">&#39;contents&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;proteomics-comparison-table-upload&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;proteomics-comparison-table-upload-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_check_comparison_table</span><span class="p">(</span>
    <span class="n">contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">current_style</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate uploaded comparison table for differential analysis.</span>

<span class="sd">    :param contents: Base64 contents of uploaded comparison file.</span>
<span class="sd">    :param filename: Uploaded filename.</span>
<span class="sd">    :param current_style: Current success indicator style.</span>
<span class="sd">    :param data_dictionary: Data dictionary with sample group information.</span>
<span class="sd">    :returns: Tuple of (updated style, parsed comparison data or None).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parsing</span><span class="o">.</span><span class="n">check_comparison_file</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span> <span class="n">current_style</span><span class="p">)</span></div>


<div class="viewcode-block" id="proteomics_volcano_plots">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.proteomics_volcano_plots">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-volcano-plot-div&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-volcano-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-volcanoes-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-imputation-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-control-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-comparison-table-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-comparison-table-upload-success&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-fc-value-threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-p-value-threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;proteomics-test-type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">proteomics_volcano_plots</span><span class="p">(</span>
    <span class="n">imputed_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> 
    <span class="n">control_group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">comparison_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> 
    <span class="n">comparison_upload_success_style</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">fc_thr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
    <span class="n">p_thr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
    <span class="n">test_type</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create volcano plots for proteomics differential abundance analysis.</span>

<span class="sd">    :param imputed_data: Imputed proteomics data for analysis.</span>
<span class="sd">    :param control_group: Selected control group name for control-based comparisons.</span>
<span class="sd">    :param comparison_data: Comparison table data for custom comparisons.</span>
<span class="sd">    :param comparison_upload_success_style: Style indicating comparison table validation status.</span>
<span class="sd">    :param data_dictionary: Main data dictionary with sample information.</span>
<span class="sd">    :param fc_thr: Fold-change threshold for significance.</span>
<span class="sd">    :param p_thr: P-value threshold for significance.</span>
<span class="sd">    :param test_type: Statistical test type to use.</span>
<span class="sd">    :returns: Tuple of (volcano plot components, differential data, completion notifier) or no_update on invalid input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">imputed_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">if</span> <span class="n">control_group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">comparison_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Proteomics volcano: no comparison data: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">no_update</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comparison_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Proteomics volcano: Comparison data len 0: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">no_update</span>
        <span class="k">if</span> <span class="n">comparison_upload_success_style</span><span class="p">[</span><span class="s1">&#39;background-color&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Proteomics volcano: comparison data failed validation: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">no_update</span>
    <span class="n">sgroups</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">parse_comparisons</span><span class="p">(</span>
        <span class="n">control_group</span><span class="p">,</span> <span class="n">comparison_data</span><span class="p">,</span> <span class="n">sgroups</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">proteomics</span><span class="o">.</span><span class="n">differential_abundance</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">,</span> <span class="n">sgroups</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">fc_thr</span><span class="p">,</span> <span class="n">p_thr</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span> <span class="n">test_type</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Data paths&#39;</span><span class="p">][</span><span class="s1">&#39;Database file&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,)</span></div>


<span class="c1"># Need to implement:</span>
<span class="c1"># GOBP mapping</span>


<div class="viewcode-block" id="select_all_none_controls">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.select_all_none_controls">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-uploaded-controls&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-select-all-uploaded&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)],</span>
    <span class="p">[</span><span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-uploaded-controls&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">)],</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_all_none_controls</span><span class="p">(</span><span class="n">all_selected</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select or deselect all uploaded control samples.</span>

<span class="sd">    :param all_selected: Whether the &quot;select all&quot; checkbox is checked.</span>
<span class="sd">    :param options: Available control sample options with &#39;value&#39; keys.</span>
<span class="sd">    :returns: All values if selected, otherwise an empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_or_none</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">all_selected</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">all_or_none</span></div>


<div class="viewcode-block" id="select_none_enrichments">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.select_none_enrichments">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-enrichments&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-select-none-enrichments&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">)],</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_none_enrichments</span><span class="p">(</span><span class="n">deselect_click</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deselect all enrichment options.</span>

<span class="sd">    :param deselect_click: Number of times the deselect button has been clicked.</span>
<span class="sd">    :returns: Empty list to clear all enrichment selections.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_or_none</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">all_or_none</span></div>


<div class="viewcode-block" id="collapse_or_uncollapse_input">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.collapse_or_uncollapse_input">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;input-header&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;input-collapse&#39;</span><span class="p">,</span><span class="s1">&#39;is_open&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;input-header&#39;</span><span class="p">,</span><span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;begin-analysis-button&#39;</span><span class="p">,</span><span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;input-collapse&#39;</span><span class="p">,</span><span class="s1">&#39;is_open&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collapse_or_uncollapse_input</span><span class="p">(</span>
    <span class="n">header_click</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
    <span class="n">begin_click</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
    <span class="n">input_is_open</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Toggle the collapse state of the input section.</span>

<span class="sd">    :param header_click: Number of clicks on the header (unused).</span>
<span class="sd">    :param begin_click: Number of clicks on the begin analysis button (unused).</span>
<span class="sd">    :param input_is_open: Current collapse state of the input section.</span>
<span class="sd">    :returns: Tuple of (new header text with arrow, new collapse state).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">input_is_open</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39; Input&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39; Input&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="select_all_none_inbuilt_controls">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.select_all_none_inbuilt_controls">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-additional-control-sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-select-all-inbuilt-controls&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)],</span>
    <span class="p">[</span><span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-additional-control-sets&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">)],</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_all_none_inbuilt_controls</span><span class="p">(</span><span class="n">all_selected</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select or deselect all inbuilt control sets.</span>

<span class="sd">    :param all_selected: Whether the &quot;select all&quot; checkbox is checked.</span>
<span class="sd">    :param options: Available inbuilt control set options with &#39;value&#39; keys.</span>
<span class="sd">    :returns: All values if selected, otherwise an empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_or_none</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">all_selected</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">all_or_none</span></div>



<div class="viewcode-block" id="select_all_none_crapomes">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.select_all_none_crapomes">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-crapome-sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-select-all-crapomes&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)],</span>
    <span class="p">[</span><span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-crapome-sets&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">)],</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_all_none_crapomes</span><span class="p">(</span><span class="n">all_selected</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select or deselect all CRAPome control sets.</span>

<span class="sd">    :param all_selected: Whether the &quot;select all&quot; checkbox is checked.</span>
<span class="sd">    :param options: Available CRAPome control set options with &#39;value&#39; keys.</span>
<span class="sd">    :returns: All values if selected, otherwise an empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_or_none</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">all_selected</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">all_or_none</span></div>



<div class="viewcode-block" id="interactomics_saint_analysis">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_saint_analysis">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;workflow-plot&#39;</span><span class="p">,</span>
           <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-container&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-input-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-crapome-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;button-run-saint-analysis&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-uploaded-controls&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-additional-control-sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-crapome-sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_saint_analysis</span><span class="p">(</span>
    <span class="n">nclicks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
    <span class="n">uploaded_controls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">additional_controls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">crapomes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
    <span class="n">uploaded_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize SAINT analysis with selected control samples and parameters.</span>

<span class="sd">    :param nclicks: Number of clicks on run analysis button.</span>
<span class="sd">    :param uploaded_controls: Selected uploaded control samples.</span>
<span class="sd">    :param additional_controls: Selected additional control sets.</span>
<span class="sd">    :param crapomes: Selected CRAPome control sets.</span>
<span class="sd">    :param uploaded_data: Uploaded experimental data dictionary.</span>
<span class="sd">    :param proximity_filtering_checklist: Selected filtering options.</span>
<span class="sd">    :param n_controls: Number of nearest controls if proximity filtering enabled.</span>
<span class="sd">    :returns: Tuple of (SAINT container Div, SAINT input data, CRAPome data) or no_update if not triggered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nclicks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nclicks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">generate_saint_container</span><span class="p">(</span><span class="n">uploaded_data</span><span class="p">,</span> <span class="n">uploaded_controls</span><span class="p">,</span> <span class="n">additional_controls</span><span class="p">,</span> <span class="n">crapomes</span><span class="p">,</span> <span class="n">db_file</span><span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_run_saint">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_run_saint">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-has-error&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-running-loading&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-input-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">background</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_run_saint</span><span class="p">(</span>
    <span class="n">saint_input</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute SAINT analysis using prepared input data.</span>

<span class="sd">    :param saint_input: Prepared SAINT input data.</span>
<span class="sd">    :param data_dictionary: Data dictionary with session and bait information.</span>
<span class="sd">    :returns: Tuple of (SAINT output data or error string, error message, empty string).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">saint_data</span><span class="p">,</span> <span class="n">saint_not_found</span> <span class="o">=</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">run_saint</span><span class="p">(</span>
        <span class="n">saint_input</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;External tools&#39;</span><span class="p">][</span><span class="s1">&#39;SAINT tempdir&#39;</span><span class="p">],</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">][</span><span class="s1">&#39;session name&#39;</span><span class="p">],</span>
        <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">][</span><span class="s1">&#39;bait uniprots&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">sainterr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">saint_not_found</span><span class="p">:</span>
        <span class="n">sainterr</span> <span class="o">=</span> <span class="s1">&#39;SAINT executable was not found, scoring data is randomized&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">saint_data</span><span class="p">,</span> <span class="n">sainterr</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_add_crapome_to_saint">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_add_crapome_to_saint">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-final-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-crapome-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_add_crapome_to_saint</span><span class="p">(</span>
    <span class="n">saint_output</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> 
    <span class="n">crapome</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrate CRAPome data with SAINT analysis results.</span>

<span class="sd">    :param saint_output: Results from SAINT analysis.</span>
<span class="sd">    :param crapome: CRAPome control data to integrate.</span>
<span class="sd">    :returns: Combined SAINT and CRAPome data, or error string if SAINT failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">saint_output</span> <span class="o">==</span> <span class="s1">&#39;SAINT failed. Can not proceed.&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">saint_output</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">add_crapome</span><span class="p">(</span><span class="n">saint_output</span><span class="p">,</span> <span class="n">crapome</span><span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_create_saint_filtering_container">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_create_saint_filtering_container">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-filtering-container&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-final-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-has-error&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-rescue-filtered-out&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_create_saint_filtering_container</span><span class="p">(</span>
    <span class="n">saint_output_ready</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> 
    <span class="n">saint_not_found</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rescue</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the filtering container for SAINT analysis results.</span>

<span class="sd">    :param saint_output_ready: Final SAINT analysis output data.</span>
<span class="sd">    :param saint_not_found: Error message if SAINT executable was not found.</span>
<span class="sd">    :param rescue: Selected rescue options.</span>
<span class="sd">    :returns: Tuple of (completion notifier, filtering container Div).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rescue_bool</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Rescue interactions that pass filter in any sample group&#39;</span> <span class="ow">in</span> <span class="n">rescue</span><span class="p">)</span>
    <span class="n">saint_found</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">saint_not_found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;SAINT failed.&#39;</span> <span class="ow">in</span> <span class="n">saint_output_ready</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;saint-failed&#39;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="n">saint_output_ready</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ui</span><span class="o">.</span><span class="n">saint_filtering_container</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">],</span> <span class="n">rescue_bool</span><span class="p">,</span> <span class="n">saint_found</span><span class="p">))</span></div>


<div class="viewcode-block" id="interactomics_draw_saint_histogram">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_draw_saint_histogram">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-bfdr-histogram&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-bfdr-histogram-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;input-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtering-area&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-final-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_draw_saint_histogram</span><span class="p">(</span>
    <span class="n">container_ready</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> 
    <span class="n">saint_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">saint_output_filtered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate histogram visualization of SAINT BFDR scores.</span>

<span class="sd">    :param container_ready: Trigger indicating the filtering container is ready.</span>
<span class="sd">    :param saint_output: Original SAINT analysis results.</span>
<span class="sd">    :param saint_output_filtered: Filtered SAINT results, if available.</span>
<span class="sd">    :returns: Tuple of (BFDR histogram Figure, histogram data JSON).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">saint_output_filtered</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">saint_output</span> <span class="o">=</span> <span class="n">saint_output_filtered</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">saint_histogram</span><span class="p">(</span><span class="n">saint_output</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="interactomics_apply_saint_filtering">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_apply_saint_filtering">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-bfdr-filter-threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-crapome-frequency-threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-crapome-rescue-threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-final-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-rescue-filtered-out&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_apply_saint_filtering</span><span class="p">(</span>
    <span class="n">bfdr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
    <span class="n">crapome_percentage</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
    <span class="n">crapome_fc</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
    <span class="n">saint_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">rescue</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply filtering criteria to SAINT analysis results.</span>

<span class="sd">    :param bfdr_threshold: BFDR score threshold.</span>
<span class="sd">    :param crapome_percentage: CRAPome frequency threshold.</span>
<span class="sd">    :param crapome_fc: CRAPome fold-change threshold.</span>
<span class="sd">    :param saint_output: SAINT results to filter.</span>
<span class="sd">    :param rescue: Selected rescue options.</span>
<span class="sd">    :returns: Filtered SAINT results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">saint_filtering</span><span class="p">(</span><span class="n">saint_output</span><span class="p">,</span> <span class="n">bfdr_threshold</span><span class="p">,</span> <span class="n">crapome_percentage</span><span class="p">,</span> <span class="n">crapome_fc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rescue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_draw_saint_filtered_figure">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_draw_saint_filtered_figure">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-saint-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;figure&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-graph-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_draw_saint_filtered_figure</span><span class="p">(</span><span class="n">filtered_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create visualization of filtered SAINT analysis results.</span>

<span class="sd">    :param filtered_output: Filtered SAINT analysis results.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (Figure for filtered results, graph data JSON).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">saint_counts</span><span class="p">(</span><span class="n">filtered_output</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">],</span> <span class="n">replicate_colors</span><span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_initiate_post_saint">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_initiate_post_saint">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span>
           <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-analysis-post-saint-area&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-button-done-filtering&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_initiate_post_saint</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the post-SAINT analysis interface container.</span>

<span class="sd">    :param _: Clicks on done filtering button (unused).</span>
<span class="sd">    :returns: Div containing post-SAINT analysis interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">post_saint_container</span><span class="p">()</span></div>


<div class="viewcode-block" id="interactomics_map_intensity">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_map_intensity">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-and-intensity-mapped-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interactomics-button-done-filtering&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_callback</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_map_intensity</span><span class="p">(</span><span class="n">n_clicks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">filtered_saint_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map averaged intensity to filtered SAINT results.</span>

<span class="sd">    :param n_clicks: Clicks on done filtering button.</span>
<span class="sd">    :param filtered_saint_data: Filtered SAINT results.</span>
<span class="sd">    :param data_dictionary: Data dictionary with intensity values and sample groups.</span>
<span class="sd">    :returns: JSON string of SAINT results with mapped intensity, or no_update if not triggered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_clicks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_clicks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">no_update</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">map_intensity</span><span class="p">(</span><span class="n">filtered_saint_data</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;data tables&#39;</span><span class="p">][</span><span class="s1">&#39;intensity&#39;</span><span class="p">],</span> <span class="n">data_dictionary</span><span class="p">[</span><span class="s1">&#39;sample groups&#39;</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="interactomics_known_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_known_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span> 
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-known-loading&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filt-int-known-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-and-intensity-mapped-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-with-contaminants-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_known_plot</span><span class="p">(</span><span class="n">saint_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">rep_colors_with_cont</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create plot showing known interactions in SAINT results.</span>

<span class="sd">    :param saint_output: SAINT results with mapped intensity values.</span>
<span class="sd">    :param rep_colors_with_cont: Color assignments for samples including contaminants.</span>
<span class="sd">    :returns: Tuple of (plot components, known interactions data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">known_plot</span><span class="p">(</span><span class="n">saint_output</span><span class="p">,</span> <span class="n">db_file</span><span class="p">,</span> <span class="n">rep_colors_with_cont</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;half-height&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="interactomics_common_proteins_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_common_proteins_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-common-loading&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-common-protein-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filt-int-known-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_common_proteins_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">saint_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create plot showing common proteins across SAINT results.</span>

<span class="sd">    :param _: Trigger input from known interactions plot (unused).</span>
<span class="sd">    :param saint_data: Filtered SAINT analysis results.</span>
<span class="sd">    :returns: Tuple of (common proteins plot components, data for storage).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">saint_data</span> <span class="o">=</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">get_saint_matrix</span><span class="p">(</span><span class="n">saint_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qc_analysis</span><span class="o">.</span><span class="n">common_proteins</span><span class="p">(</span>
        <span class="n">saint_data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">),</span>
        <span class="n">db_file</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="n">additional_groups</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Other contaminants&#39;</span><span class="p">:</span> <span class="n">contaminant_list</span>
        <span class="p">},</span>
        <span class="n">id_str</span><span class="o">=</span><span class="s1">&#39;interactomics&#39;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_pca_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_pca_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-pca-loading&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-pca-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-common-protein-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;replicate-colors-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_pca_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">saint_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">replicate_colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a PCA plot for interactomics data.</span>

<span class="sd">    :param _: Trigger input from common proteins plot (unused).</span>
<span class="sd">    :param saint_data: Filtered SAINT analysis results.</span>
<span class="sd">    :param replicate_colors: Color assignments for sample replicates.</span>
<span class="sd">    :returns: Tuple of (PCA plot components, PCA data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">pca</span><span class="p">(</span>
        <span class="n">saint_data</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="n">replicate_colors</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_ms_microscopy_plots">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_ms_microscopy_plots">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-msmic-loading&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-msmic-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-pca-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_ms_microscopy_plots</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">saint_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create MS microscopy visualization plots.</span>

<span class="sd">    :param _: Trigger input from PCA plot (unused).</span>
<span class="sd">    :param saint_output: Filtered SAINT analysis results.</span>
<span class="sd">    :returns: Tuple of (MS microscopy plot components, analysis data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">do_ms_microscopy</span><span class="p">(</span><span class="n">saint_output</span><span class="p">,</span> <span class="n">db_file</span><span class="p">,</span> 
                                       <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span> 
                                       <span class="n">version</span><span class="o">=</span><span class="s1">&#39;v1.0&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="interactomics_network_plot">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_network_plot">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-network-loading&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-network-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-network-interactions-data-store&#39;</span><span class="p">},</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-msmic-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_network_plot</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">saint_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create interactive network visualization of protein interactions.</span>

<span class="sd">    :param _: Trigger input from MS microscopy plot (unused).</span>
<span class="sd">    :param saint_output: Filtered SAINT analysis results.</span>
<span class="sd">    :returns: Tuple of (completion notifier, network container, elements, interactions).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">container</span><span class="p">,</span> <span class="n">c_elements</span><span class="p">,</span> <span class="n">interactions</span> <span class="o">=</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">do_network</span><span class="p">(</span>
        <span class="n">saint_output</span><span class="p">,</span> 
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">c_elements</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span></div>


<div class="viewcode-block" id="interactomics_enrichment">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.interactomics_enrichment">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;interactomics-enrichment-loading&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-enrichment-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-enrichment-information-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-network-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-saint-filtered-output-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;interactomics-choose-enrichments&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">background</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">interactomics_enrichment</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">saint_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
    <span class="n">chosen_enrichments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform enrichment analysis on filtered interactomics data.</span>

<span class="sd">    :param _: Trigger input from network plot (unused).</span>
<span class="sd">    :param saint_output: Filtered SAINT analysis results.</span>
<span class="sd">    :param chosen_enrichments: Selected enrichment analyses to perform.</span>
<span class="sd">    :returns: Tuple of (completion notifier, enrichment plots, results data, info data).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,)</span> <span class="o">+</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">enrich</span><span class="p">(</span>
        <span class="n">saint_output</span><span class="p">,</span> 
        <span class="n">chosen_enrichments</span><span class="p">,</span> 
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">],</span>
        <span class="n">parameters_file</span><span class="o">=</span><span class="n">parameters_file</span>
    <span class="p">)</span></div>


<span class="c1">########################################</span>
<span class="c1"># Interactomics network plot callbacks #</span>
<span class="c1">########################################</span>
<span class="c1">## Visdcc package is currently unused, because it&#39;s impossible to export anything sensible out of it.</span>
<span class="c1">## Export would require javascript, but there is no time to do any of this.</span>
<span class="c1">## Perhaps in the future though? </span>
<span class="c1">## This callback will be left here, same as the modifications in interactomics.network_display_data</span>
<span class="c1">## So that if export is possible in the future, we can just plug in the visdcc network plot.</span>
<div class="viewcode-block" id="display_tap_node">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.display_tap_node">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;nodedata-div&quot;</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;cytoscape&quot;</span><span class="p">,</span> <span class="s2">&quot;tapNode&quot;</span><span class="p">),</span>
   <span class="c1"># Input(&#39;visdcc-network&#39;,&#39;selection&#39;),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span>
          <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;interactomics-network-interactions-data-store&#39;</span><span class="p">},</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">display_tap_node</span><span class="p">(</span><span class="n">node_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">int_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">network_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Cytoscape&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display detailed information for a selected node in the network visualization.</span>

<span class="sd">    :param node_data: Data associated with the tapped network node.</span>
<span class="sd">    :param int_data: Network interaction data store.</span>
<span class="sd">    :param network_type: Network visualization type (default &#39;Cytoscape&#39;).</span>
<span class="sd">    :returns: Div with node connection details, or None if not selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">node_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">network_type</span> <span class="o">==</span> <span class="s1">&#39;Cytoscape&#39;</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">interactomics</span><span class="o">.</span><span class="n">network_display_data</span><span class="p">(</span>
            <span class="n">node_data</span><span class="p">,</span>
            <span class="n">int_data</span><span class="p">,</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Figure defaults&#39;</span><span class="p">][</span><span class="s1">&#39;full-height&#39;</span><span class="p">][</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="update_cytoscape_layout">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.update_cytoscape_layout">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;cytoscape&quot;</span><span class="p">,</span> <span class="s2">&quot;layout&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;dropdown-layout&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_cytoscape_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update Cytoscape network layout configuration.</span>

<span class="sd">    :param layout: Selected layout type from dropdown.</span>
<span class="sd">    :returns: Layout configuration dict including extra parameters if defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret_dic</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">layout</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">layout</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Cytoscape layout parameters&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Cytoscape layout parameters&#39;</span><span class="p">][</span><span class="n">layout</span><span class="p">]:</span>
            <span class="n">ret_dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">ret_dic</span></div>



<span class="c1">########################################</span>

<div class="viewcode-block" id="table_of_contents">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.table_of_contents">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;toc-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;qc-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;workflow-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;proteomics-clustering-done-notifier&#39;</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;workflow-volcanoes-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;main-content-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">table_of_contents</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">___</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">____</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">main_div_contents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the table of contents based on main content.</span>

<span class="sd">    :param _: Trigger input (unused).</span>
<span class="sd">    :param __: Trigger input (unused).</span>
<span class="sd">    :param ___: Trigger input (unused).</span>
<span class="sd">    :param ____: Trigger input (unused).</span>
<span class="sd">    :param main_div_contents: Current contents of main div.</span>
<span class="sd">    :returns: Updated table of contents component.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">table_of_contents</span><span class="p">(</span><span class="n">main_div_contents</span><span class="p">)</span></div>


<div class="viewcode-block" id="workflow_area">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.workflow_area">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-specific-input-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span><span class="n">allow_duplicate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;workflow-specific-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">,</span><span class="n">allow_duplicate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;qc-done-notifier&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;workflow-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">workflow_area</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> 
    <span class="n">workflow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update workflow-specific areas based on selected workflow.</span>

<span class="sd">    :param _: Trigger input from QC completion notifier (unused).</span>
<span class="sd">    :param workflow: Selected workflow type.</span>
<span class="sd">    :param data_dictionary: Data dictionary containing uploaded data.</span>
<span class="sd">    :returns: Tuple of (workflow input area, workflow content area).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ui</span><span class="o">.</span><span class="n">workflow_area</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;workflow parameters&#39;</span><span class="p">],</span> <span class="n">data_dictionary</span><span class="p">)</span></div>



<div class="viewcode-block" id="download_example_comparison_file">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.download_example_comparison_file">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download-proteomics-comparison-example&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-proteomics-comparison-example-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_example_comparison_file</span><span class="p">(</span><span class="n">n_clicks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide example proteomics comparison file for download.</span>

<span class="sd">    :param n_clicks: Number of clicks on the download button.</span>
<span class="sd">    :returns: dcc.send_file payload for the example file, or None if not triggered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_clicks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">n_clicks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">dcc</span><span class="o">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Data paths&#39;</span><span class="p">][</span><span class="s1">&#39;Example proteomics comparison file&#39;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="example_files_download">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.example_files_download">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download-example-files&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;button-download-example-files&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">example_files_download</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide example files bundle for download.</span>

<span class="sd">    :param _: Number of clicks on download button (unused).</span>
<span class="sd">    :returns: dcc.send_file payload for the zipped example files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dcc</span><span class="o">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">zipdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Data paths&#39;</span><span class="p">][</span><span class="s1">&#39;Example files&#39;</span><span class="p">])))</span></div>


<div class="viewcode-block" id="get_adiv_by_id">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.get_adiv_by_id">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_adiv_by_id</span><span class="p">(</span>
    <span class="n">divs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> 
    <span class="n">idvals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> 
    <span class="n">idval_to_find</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a specific div element by matching its ID.</span>

<span class="sd">    :param divs: List of div elements.</span>
<span class="sd">    :param idvals: List of dicts containing ID values (with key &#39;id&#39;).</span>
<span class="sd">    :param idval_to_find: Target ID value to search for.</span>
<span class="sd">    :returns: Matching div element if found, otherwise None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">use_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idvals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idval</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">idval_to_find</span><span class="p">:</span>
            <span class="n">use_index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">use_index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">divs</span><span class="p">[</span><span class="n">use_index</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1">##################################</span>
<span class="c1">##   Start of export section    ##</span>
<span class="c1">##################################</span>
<span class="c1"># Export needed to be split apart due to taking too long otherwise with background callbacks.</span>
<span class="c1"># Background callbacks were disabled due to some weird-ass bug that had something to do with volcano plots and excessive numbers of differentially abundant proteins.</span>
<span class="c1"># These could now be merged back into one, I guess</span>

<div class="viewcode-block" id="prepare_for_download">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.prepare_for_download">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;button-download-all-data-text&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">,</span><span class="n">allow_duplicate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;button-download-all-data&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;upload-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prepare_for_download</span><span class="p">(</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
    <span class="n">main_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare directory structure and README for data export.</span>

<span class="sd">    :param _: Clicks on download button (unused).</span>
<span class="sd">    :param main_data: Data dictionary containing session information.</span>
<span class="sd">    :returns: Tuple of (export directory path, temporary loading indicators Div).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M&quot;</span><span class="p">)</span>

    <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Data paths&#39;</span><span class="p">][</span><span class="s1">&#39;Cache dir&#39;</span><span class="p">],</span>  
                                 <span class="n">main_data</span><span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">][</span><span class="s1">&#39;session name&#39;</span><span class="p">],</span> 
                                 <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1"> Proteogyver output&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">export_dir</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">export_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">export_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">export_dir</span><span class="p">,</span> <span class="n">infra</span><span class="o">.</span><span class="n">temporary_download_button_loading_divs</span><span class="p">()</span></div>


<div class="viewcode-block" id="save_input_stores">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_input_stores">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp1&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp1&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;input-stores&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_input_stores</span><span class="p">(</span><span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save input data stores to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param stores: Input data stores to save.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_input_stores at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">infra</span><span class="o">.</span><span class="n">write_README</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;output_guide.md&#39;</span><span class="p">))</span>
    <span class="n">infra</span><span class="o">.</span><span class="n">save_data_stores</span><span class="p">(</span><span class="n">stores</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_input_stores, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_input_stores done&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="save_workflow_stores">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_workflow_stores">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp2&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp2&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;workflow-stores&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_workflow_stores</span><span class="p">(</span><span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save workflow data stores to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param stores: Workflow data stores to save.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_workflow_stores at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">infra</span><span class="o">.</span><span class="n">save_data_stores</span><span class="p">(</span><span class="n">stores</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_workflow_stores, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_workflow_stores done&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="save_qc_figures">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_qc_figures">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp3&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp3&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;id&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;data-store&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;commonality-figure-pdf-data-store&#39;</span><span class="p">},</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;workflow-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_qc_figures</span><span class="p">(</span>
    <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">analysis_divs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">],</span> 
    <span class="n">analysis_div_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> 
    <span class="n">commonality_pdf_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> 
    <span class="n">workflow</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save quality control figures to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param analysis_divs: Analysis div elements.</span>
<span class="sd">    :param analysis_div_ids: IDs of analysis divs.</span>
<span class="sd">    :param commonality_pdf_data: Optional PDF data for commonality figures.</span>
<span class="sd">    :param workflow: Current workflow name.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_qc_figures at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infra</span><span class="o">.</span><span class="n">save_figures</span><span class="p">([</span><span class="n">get_adiv_by_id</span><span class="p">(</span><span class="n">analysis_divs</span><span class="p">,</span> <span class="n">analysis_div_ids</span><span class="p">,</span> <span class="s1">&#39;qc-analysis-area&#39;</span><span class="p">)],</span> 
                          <span class="n">export_dir</span><span class="p">,</span>
                          <span class="n">figure_output_formats</span><span class="p">,</span> 
                          <span class="n">commonality_pdf_data</span><span class="p">,</span> 
                          <span class="n">workflow</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;save_qc_figures failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="s1">&#39;save_qc_figures_errors&#39;</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_qc_figures, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_qc_figures done&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="save_information">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_information">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp4&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp4&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;input-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_information</span><span class="p">(</span><span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_divs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save input information to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param input_divs: Input div elements to inspect.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_input_information at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">infra</span><span class="o">.</span><span class="n">save_input_information</span><span class="p">(</span><span class="n">input_divs</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_input_information, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_input_information done&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="save_interactomics_figures">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_interactomics_figures">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp5&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp5&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;id&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;workflow-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_interactomics_figures</span><span class="p">(</span>
    <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">analysis_divs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">],</span> 
    <span class="n">analysis_div_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> 
    <span class="n">workflow</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save interactomics analysis figures to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param analysis_divs: Analysis div elements.</span>
<span class="sd">    :param analysis_div_ids: IDs of analysis divs.</span>
<span class="sd">    :param workflow: Current workflow name.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_interactomics_figures at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infra</span><span class="o">.</span><span class="n">save_figures</span><span class="p">([</span><span class="n">get_adiv_by_id</span><span class="p">(</span><span class="n">analysis_divs</span><span class="p">,</span> <span class="n">analysis_div_ids</span><span class="p">,</span> <span class="s1">&#39;interactomics-analysis-results-area&#39;</span><span class="p">)],</span> <span class="n">export_dir</span><span class="p">,</span>
                    <span class="n">figure_output_formats</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;save_interactomics_figures failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">tb</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save_interactomics_figures failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">tb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="s2">&quot;save_interactomics_figures_errors.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save_interactomics_figures failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">tb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_interactomics_figures, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_interactomics_figures done&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="save_interactomics_post_saint_figures">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_interactomics_post_saint_figures">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp6&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp6&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;id&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;workflow-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_interactomics_post_saint_figures</span><span class="p">(</span>
    <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">analysis_divs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">],</span> 
    <span class="n">analysis_div_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> 
    <span class="n">workflow</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save post-SAINT interactomics figures to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param analysis_divs: Analysis div elements.</span>
<span class="sd">    :param analysis_div_ids: IDs of analysis divs.</span>
<span class="sd">    :param workflow: Current workflow name.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_interactomics_post_saint_figures at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infra</span><span class="o">.</span><span class="n">save_figures</span><span class="p">([</span><span class="n">get_adiv_by_id</span><span class="p">(</span><span class="n">analysis_divs</span><span class="p">,</span> <span class="n">analysis_div_ids</span><span class="p">,</span> <span class="s1">&#39;interactomics-analysis-post-saint-area&#39;</span><span class="p">)],</span> 
                          <span class="n">export_dir</span><span class="p">,</span> <span class="n">figure_output_formats</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;save_interactomics_post_saint_figures failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="s1">&#39;save_interactomics_post_saint_figures_errors&#39;</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_interactomics_post_saint_figures, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_interactomics_post_saint_figures done&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="save_proteomics_figures">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.save_proteomics_figures">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_temp7&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download_loading_temp7&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;analysis-div&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">},</span> <span class="s1">&#39;id&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;workflow-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_proteomics_figures</span><span class="p">(</span>
    <span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">analysis_divs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">],</span> 
    <span class="n">analysis_div_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> 
    <span class="n">workflow</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save proteomics analysis figures to export directory.</span>

<span class="sd">    :param export_dir: Destination directory.</span>
<span class="sd">    :param analysis_divs: Analysis div elements.</span>
<span class="sd">    :param analysis_div_ids: IDs of analysis divs.</span>
<span class="sd">    :param workflow: Current workflow name.</span>
<span class="sd">    :returns: Tuple of (completion message, loading indicator text).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received download request save_proteomics_figures at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infra</span><span class="o">.</span><span class="n">save_figures</span><span class="p">([</span><span class="n">get_adiv_by_id</span><span class="p">(</span><span class="n">analysis_divs</span><span class="p">,</span> <span class="n">analysis_div_ids</span><span class="p">,</span> <span class="s1">&#39;proteomics-analysis-results-area&#39;</span><span class="p">)],</span> 
                          <span class="n">export_dir</span><span class="p">,</span> <span class="n">figure_output_formats</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;save_proteomics_figures failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="s1">&#39;save_proteomics_figures_errors&#39;</span><span class="p">),</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
            <span class="n">fil</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done with download request save_proteomics_figures, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;save_proteomics_figures done&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>

    
<div class="viewcode-block" id="send_data">
<a class="viewcode-back" href="../../../code/app.pages.html#app.pages.QC_and_data_analysis.send_data">[docs]</a>
<span class="nd">@callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;download-all-data&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;button-download-all-data-text&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">,</span> <span class="n">allow_duplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download-temp-dir-ready&#39;</span><span class="p">,</span><span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp1&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp2&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp3&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp4&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp5&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp6&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;download_temp7&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">send_data</span><span class="p">(</span><span class="n">export_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and send a ZIP archive containing all exported analysis data.</span>

<span class="sd">    :param export_dir: Temporary export directory path.</span>
<span class="sd">    :param args: Completion tokens from prior export steps (must include &#39;done&#39;).</span>
<span class="sd">    :returns: Tuple of (send_bytes payload, updated button text) or no_update while incomplete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify all export steps are complete</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;done&#39;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span>
            
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>    
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M&quot;</span><span class="p">)</span>
    <span class="n">zip_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> ProteoGyver output.zip&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Started packing data at </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create ZIP archive</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">export_dir</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="n">zip_filename</span><span class="p">:</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                        <span class="n">arcname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">export_dir</span><span class="p">)</span>
                        <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">arcname</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;done packing data, took </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1"># Read ZIP file and encode for download</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">zip_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        
        <span class="c1"># Clean up temporary files</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">export_dir</span><span class="p">)</span>
    
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating download package: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">no_update</span><span class="p">,</span> <span class="n">no_update</span>

    <span class="k">return</span> <span class="n">dcc</span><span class="o">.</span><span class="n">send_bytes</span><span class="p">(</span><span class="n">zip_data</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">),</span> <span class="s1">&#39;Download all data&#39;</span></div>

<span class="c1">##################################</span>
<span class="c1">##    End of export section     ##</span>
<span class="c1">##################################</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kari Salokas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
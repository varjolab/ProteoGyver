

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>app.components.api_tools.biogrid &mdash; ProteoGyver Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=aaadad1f"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ProteoGyver
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/modules.html">2025_ProteoGyver</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ProteoGyver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../app.html">app</a></li>
      <li class="breadcrumb-item active">app.components.api_tools.biogrid</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for app.components.api_tools.biogrid</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">BioGRID interaction data utilities.</span>

<span class="sd">This module provides helpers to download, parse and manage BioGRID</span>
<span class="sd">protein-protein interaction data and expose them as normalized</span>
<span class="sd">tab-separated files and pandas DataFrames.</span>

<span class="sd">Main entry points:</span>
<span class="sd">- ``update``: checks remote and updates the local BioGRID cache if needed</span>
<span class="sd">- ``get_latest``: loads the latest cached data as a DataFrame</span>
<span class="sd">- ``methods_text``: returns a ready-to-use methods description</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>
<span class="sd">The processing pipelines operate on large datasets and therefore use</span>
<span class="sd">chunked reading and on-disk sharding (by interaction prefix) to reduce</span>
<span class="sd">memory pressure.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">zipfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZipFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">apitools</span>

<div class="viewcode-block" id="deduplicate_str_dataframe_by_index">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.deduplicate_str_dataframe_by_index">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">deduplicate_str_dataframe_by_index</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deduplicate string values per index by merging rows.</span>

<span class="sd">    For each index value, string-like columns are split by ``;``,</span>
<span class="sd">    deduplicated, sorted, and then re-joined with ``;``.</span>

<span class="sd">    :param df: Input DataFrame with potentially duplicated index rows.</span>
<span class="sd">    :returns: DataFrame where rows sharing an index are merged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">merge_row_group</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
        <span class="n">merged_row</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">split_vals</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">all_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">split_vals</span><span class="p">))</span>
            <span class="n">deduped</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_vals</span><span class="p">))</span>
            <span class="n">merged_row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">deduped</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">deduped</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">merged_row</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">merge_row_group</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_upid">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.get_upid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_upid</span><span class="p">(</span><span class="n">upcol</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize UniProt IDs contained in a Series.</span>

<span class="sd">    Removes placeholder/null tokens and converts empty results to ``NaN``.</span>

<span class="sd">    :param upcol: Series containing UniProt accessions as strings.</span>
<span class="sd">    :returns: Cleaned Series with empty values converted to ``NaN``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">news</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">upcol</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">nullchar</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span><span class="s1">&#39;nan&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">nullchar</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">news</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">retser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">news</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">upcol</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">upcol</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">retser</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retser</span></div>


<div class="viewcode-block" id="filter_chunk">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.filter_chunk">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_chunk</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">:</span><span class="nb">set</span><span class="o">|</span><span class="kc">None</span><span class="p">,</span> <span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter and normalize a BioGRID chunk.</span>

<span class="sd">    Keeps only physical interactions with valid UniProt accessions,</span>
<span class="sd">    applies optional organism and UniProt filters, derives helper</span>
<span class="sd">    columns, and prepares processed variants for downstream merging.</span>

<span class="sd">    :param df: Raw chunk as read from BioGRID TAB3 file.</span>
<span class="sd">    :param uniprots_to_get: Optional set of UniProt accessions to retain</span>
<span class="sd">        (isoforms allowed; matching is applied on base accession).</span>
<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :returns: Tuple of (filtered DataFrame, normalized column names list,</span>
<span class="sd">        interactor-specific column names list).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Experimental System Type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;physical&#39;</span><span class="p">][[</span><span class="s1">&#39;Experimental System&#39;</span><span class="p">,</span> <span class="s1">&#39;Experimental System Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Publication Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Organism ID Interactor A&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;Organism ID Interactor B&#39;</span><span class="p">,</span> <span class="s1">&#39;Throughput&#39;</span><span class="p">,</span> <span class="s1">&#39;Score&#39;</span><span class="p">,</span> <span class="s1">&#39;Modification&#39;</span><span class="p">,</span> <span class="s1">&#39;Qualifications&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="s1">&#39;Source Database&#39;</span><span class="p">,</span> <span class="s1">&#39;SWISS-PROT Accessions Interactor A&#39;</span><span class="p">,</span> <span class="s1">&#39;SWISS-PROT Accessions Interactor B&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;Ontology Term IDs&#39;</span><span class="p">,</span> <span class="s1">&#39;Ontology Term Names&#39;</span><span class="p">,</span> <span class="s1">&#39;Ontology Term Categories&#39;</span><span class="p">,</span> <span class="s1">&#39;Ontology Term Qualifier IDs&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Ontology Term Qualifier Names&#39;</span><span class="p">,</span> <span class="s1">&#39;Ontology Term Types&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Experimental System Type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;physical&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SWISS-PROT Accessions Interactor A&#39;</span><span class="p">,</span> <span class="s1">&#39;SWISS-PROT Accessions Interactor B&#39;</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;SWISS-PROT Accessions Interactor A&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;SWISS-PROT Accessions Interactor B&#39;</span><span class="p">]]</span>
    <span class="n">not_used</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Co-localization&#39;</span><span class="p">,</span><span class="s1">&#39;Co-fractionation&#39;</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">organisms</span><span class="p">:</span>
        <span class="n">organisms</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">organisms</span><span class="p">}</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Organism ID Interactor A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">organisms</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Organism ID Interactor B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">organisms</span><span class="p">))]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Experimental System&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">not_used</span><span class="p">)]</span>
    <span class="n">swcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Interactor &#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
    <span class="n">normcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">swcols</span><span class="p">]</span>
    <span class="n">renames</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">normcols</span><span class="o">+</span><span class="n">swcols</span><span class="p">}</span>
    <span class="n">renames</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;Source Database&#39;</span><span class="p">:</span> <span class="s1">&#39;source_database&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Experimental System Type&#39;</span><span class="p">:</span> <span class="s1">&#39;interaction_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Experimental System&#39;</span><span class="p">:</span> <span class="s1">&#39;interaction_detection_method&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Publication Source&#39;</span><span class="p">:</span> <span class="s1">&#39;publication_identifier&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Organism ID Interactor A&#39;</span><span class="p">:</span> <span class="s1">&#39;organism_interactor_a&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Organism ID Interactor B&#39;</span><span class="p">:</span> <span class="s1">&#39;organism_interactor_b&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Modification&#39;</span><span class="p">:</span> <span class="s1">&#39;modification&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Score&#39;</span><span class="p">:</span> <span class="s1">&#39;confidence_value&#39;</span>
    <span class="p">})</span>
    <span class="n">normcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">renames</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">normcols</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;Source Database&#39;</span><span class="p">]</span>
    <span class="n">swcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">renames</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">swcols</span> <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;SWISS-PROT&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renames</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_upid</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;swiss-prot_accessions_interactor_a&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_upid</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;swiss-prot_accessions_interactor_b&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">uniprots_to_get</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uniprots_to_get</span><span class="p">)</span> <span class="o">|</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">uniprots_to_get</span><span class="p">)]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_a_noiso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_a&#39;</span><span class="p">]]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_b_noiso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_b&#39;</span><span class="p">]]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;isoform_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_a&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;isoform_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uniprot_id_b&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;biological_role_interactor_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;annotation_interactor_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;biological_role_interactor_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;annotation_interactor_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;organism_interactor_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;organism_interactor_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;organism_interactor_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;organism_interactor_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_processed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># Pre-process normcols data using vectorized operations</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_processed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)])</span>  <span class="c1"># flatten</span>
                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">vals</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span>
                        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
                    <span class="p">])</span>
                    <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_processed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">nc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Experiment throughput from BioGRID: </span><span class="si">{</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;throughput&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">))))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;qualifications&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;qualifications&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">nc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;+Q:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;qualifications&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;modification&#39;</span><span class="p">]):</span>
            <span class="n">nc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;+Mod:</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;modification&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;update_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BioGRID:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;throughput&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;modification&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;qualifications&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;tags&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;ontology_term_ids&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ontology_term_names&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ontology_term_categories&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ontology_term_qualifier_ids&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ontology_term_qualifier_names&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ontology_term_types&#39;</span>
    <span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">normcols</span><span class="p">,</span> <span class="n">swcols</span></div>


<div class="viewcode-block" id="get_final_df">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.get_final_df">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_final_df</span><span class="p">(</span><span class="n">chunk_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">time_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate sharded chunk into a final deduplicated DataFrame.</span>

<span class="sd">    Combines semicolon-delimited values per interaction key, and manages</span>
<span class="sd">    creation/update dates by carrying forward dates from a previous</span>
<span class="sd">    version when values are unchanged.</span>

<span class="sd">    :param chunk_df: DataFrame assembled from shard files for a prefix.</span>
<span class="sd">    :param time_format: Output date format string.</span>
<span class="sd">    :returns: Final deduplicated DataFrame indexed by ``interaction``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">datarows</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">intname</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">chunk_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">datarows</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">intname</span><span class="p">,</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chunk_df</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunk_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">datarows</span><span class="p">[</span><span class="n">intname</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">c</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
    <span class="n">findf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="n">ind</span><span class="p">:</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ind_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind_dict</span> <span class="ow">in</span> <span class="n">datarows</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">findf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;interaction&#39;</span>
    <span class="n">today_str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">findf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">findf</span><span class="p">[</span><span class="s2">&quot;biogrid_creation_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">today_str</span>
    <span class="n">findf</span><span class="p">[</span><span class="s2">&quot;biogrid_updated_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">today_str</span>

    <span class="k">return</span> <span class="n">findf</span></div>


<div class="viewcode-block" id="handle_and_split_save">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.handle_and_split_save">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_and_split_save</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">normcols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">swcols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand interactor-specific rows and shard to disk by prefix.</span>

<span class="sd">    Produces a symmetric representation (A-&gt;B and B-&gt;A) and writes</span>
<span class="sd">    records into prefix-based TSV shards in ``folder_path``.</span>

<span class="sd">    :param df: Filtered and normalized chunk DataFrame.</span>
<span class="sd">    :param folder_path: Output directory for shard files.</span>
<span class="sd">    :param normcols: List of normalized, non-interactor-specific columns.</span>
<span class="sd">    :param swcols: List of interactor-specific columns (will be expanded</span>
<span class="sd">        for both interactors).</span>
<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">swcols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;biological_role_interactor_a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;annotation_interactor_a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;biological_role_interactor_b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;annotation_interactor_b&#39;</span><span class="p">])</span>
    <span class="n">swcols</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">dfcols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;uniprot_id_a&#39;</span><span class="p">,</span>
        <span class="s1">&#39;uniprot_id_b&#39;</span><span class="p">,</span>
        <span class="s1">&#39;uniprot_id_a_noiso&#39;</span><span class="p">,</span>
        <span class="s1">&#39;uniprot_id_b_noiso&#39;</span><span class="p">,</span>
        <span class="s1">&#39;isoform_a&#39;</span><span class="p">,</span>
        <span class="s1">&#39;isoform_b&#39;</span><span class="p">,</span>
    <span class="p">]</span>  <span class="o">+</span> <span class="n">normcols</span> <span class="o">+</span> <span class="n">swcols</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;source_database&#39;</span><span class="p">,</span> <span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;update_time&#39;</span><span class="p">]</span>

    <span class="n">datarows</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">new_rows</span> <span class="o">=</span> <span class="p">[</span> 
            <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;uniprot_id_</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;uniprot_id_</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;uniprot_id_</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">_noiso&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;uniprot_id_</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1">_noiso&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;isoform_</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;isoform_</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>   
                <span class="p">]</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">_processed&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">normcols</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="n">n1</span><span class="si">}</span><span class="s1">_processed&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">swcols</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="n">n2</span><span class="si">}</span><span class="s1">_processed&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">swcols</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source_database&#39;</span><span class="p">,</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;update_time&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)]</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">new_rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">index</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_-_</span><span class="si">{</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">dfcols</span>
            <span class="n">datarows</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
                    <span class="n">datarows</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">|=</span><span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">datarows</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">datarows</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">|=</span><span class="p">{</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span>
    
    <span class="c1"># Create DataFrame in one go</span>
    <span class="n">findf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="n">ind</span><span class="p">:</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ind_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind_dict</span> <span class="ow">in</span> <span class="n">datarows</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">findf</span><span class="p">[</span><span class="s1">&#39;publication_identifier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">findf</span><span class="p">[</span><span class="s1">&#39;publication_identifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">findf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;interaction&#39;</span>
    <span class="n">split_and_save_by_prefix</span><span class="p">(</span><span class="n">findf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="s1">&#39;interaction&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="split_and_save_by_prefix">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.split_and_save_by_prefix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split_and_save_by_prefix</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_chars</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shard a DataFrame by a column prefix and append to TSV files.</span>

<span class="sd">    :param df: Input DataFrame.</span>
<span class="sd">    :param column: Column whose prefix is used for grouping.</span>
<span class="sd">    :param num_chars: Number of prefix characters to use.</span>
<span class="sd">    :param output_dir: Target directory for TSV shards.</span>
<span class="sd">    :param index: Whether to include the index in CSV output.</span>
<span class="sd">    :param sep: Field separator for CSV output.</span>
<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="n">num_chars</span><span class="p">]):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.tsv&quot;</span><span class="p">)</span>
        <span class="n">write_header</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">write_header</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span></div>


<span class="c1"># super inefficient, but run rarely, so good enough.</span>
<div class="viewcode-block" id="generate_pandas">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.generate_pandas">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_pandas</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">:</span><span class="nb">set</span><span class="o">|</span><span class="kc">None</span><span class="p">,</span> <span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a BioGRID TAB3 file into normalized TSV shards on disk.</span>

<span class="sd">    The file is read in chunks, filtered and normalized, and then</span>
<span class="sd">    expanded into symmetric interaction rows which are sharded by</span>
<span class="sd">    interaction prefix for deduplication and memory efficiency.</span>

<span class="sd">    :param file_path: Path to the downloaded ``.tab3.txt`` file.</span>
<span class="sd">    :param uniprots_to_get: Optional set of UniProt accessions to retain.</span>
<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">10000</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing BioGRID chunk: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">chunk</span><span class="p">,</span> <span class="n">normcols</span><span class="p">,</span> <span class="n">swcols</span> <span class="o">=</span> <span class="n">filter_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">,</span> <span class="n">organisms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#handle_and_split_save(chunk, temp_dir)</span>
            <span class="n">handle_and_split_save</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">normcols</span><span class="p">,</span> <span class="n">swcols</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tsv&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generating BioGRID final DataFrame for: </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">chunk_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;interaction&#39;</span><span class="p">)</span>
            <span class="n">findf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">get_final_df</span><span class="p">(</span><span class="n">chunk_df</span><span class="p">)</span>
            <span class="n">findf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="do_update">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.do_update">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_update</span><span class="p">(</span><span class="n">save_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">save_zipname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">latest_zip_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">:</span><span class="nb">set</span><span class="o">|</span><span class="kc">None</span><span class="p">,</span> <span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download, extract and convert the latest BioGRID archive.</span>

<span class="sd">    :param save_dir: Directory where the data files will be placed.</span>
<span class="sd">    :param save_zipname: Zip filename to write under ``save_dir``.</span>
<span class="sd">    :param latest_zip_url: URL for the BioGRID zip resource.</span>
<span class="sd">    :param uniprots_to_get: Optional set of UniProt accessions to retain.</span>
<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloading BioGRID&#39;</span><span class="p">)</span>
    <span class="n">urlretrieve</span><span class="p">(</span><span class="n">latest_zip_url</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">save_zipname</span><span class="p">))</span>
    <span class="n">datafile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">save_zipname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.zip&#39;</span><span class="p">,</span><span class="s1">&#39;.txt&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">datafile_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">save_zipname</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
    <span class="n">generate_pandas</span><span class="p">(</span><span class="n">datafile_path</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">,</span> <span class="n">organisms</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">save_zipname</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">datafile_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_file_chunks">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.read_file_chunks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_file_chunks</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">since_date</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a TSV shard file in chunks and optionally filter by organism.</span>

<span class="sd">    :param filepath: Path to a TSV shard.</span>
<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :param since_date: Not implemented yet; reserved for future use.</span>
<span class="sd">    :returns: Concatenated DataFrame of the shard file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iter_csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">iterator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">df_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">iter_csv</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">organisms</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;organism_interactor_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">organisms</span><span class="p">)</span> <span class="o">|</span> <span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;organism_interactor_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">organisms</span><span class="p">)]</span>
        <span class="n">df_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_parts</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_folder_chunks">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.read_folder_chunks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_folder_chunks</span><span class="p">(</span><span class="n">folderpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subset_letter</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">since_date</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load all TSV shards in a folder, optionally restricting by prefix.</span>

<span class="sd">    :param folderpath: Directory containing shard files.</span>
<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :param subset_letter: If provided, only files starting with this letter are read.</span>
<span class="sd">    :param since_date: Not implemented yet; reserved for future use.</span>
<span class="sd">    :returns: Concatenated DataFrame of all matching shards.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folderpath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">subset_letter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">subset_letter</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">df_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_file_chunks</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folderpath</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">organisms</span><span class="p">,</span> <span class="n">since_date</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_parts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">heads</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folderpath</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">heads</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span></div>


<span class="c1"># TODO: implement since_date</span>
<div class="viewcode-block" id="get_latest">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.get_latest">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_latest</span><span class="p">(</span><span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subset_letter</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">since_date</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">|</span><span class="nb">str</span> <span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch the latest BioGRID data from the local cache.</span>

<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :param subset_letter: Restrict to shards whose filename starts with this letter.</span>
<span class="sd">    :param name_only: If ``True``, return the latest folder path instead of loading data.</span>
<span class="sd">    :param since_date: Not implemented yet; reserved for future use.</span>
<span class="sd">    :returns: DataFrame of the latest BioGRID data or a path string when ``name_only=True``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">apitools</span><span class="o">.</span><span class="n">get_newest_file</span><span class="p">(</span><span class="n">apitools</span><span class="o">.</span><span class="n">get_save_location</span><span class="p">(</span><span class="s1">&#39;BioGRID&#39;</span><span class="p">))</span>
    <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">apitools</span><span class="o">.</span><span class="n">get_save_location</span><span class="p">(</span><span class="s1">&#39;BioGRID&#39;</span><span class="p">),</span> <span class="n">current_version</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name_only</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filepath</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">read_folder_chunks</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">organisms</span><span class="p">,</span> <span class="n">subset_letter</span><span class="p">,</span> <span class="n">since_date</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_available">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.get_available">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_available</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List available interaction shard names for the latest version.</span>

<span class="sd">    :returns: List of shard basenames without the ``.tsv`` suffix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">get_latest</span><span class="p">(</span><span class="n">name_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># type: ignore</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tsv&#39;</span><span class="p">)]</span></div>



<span class="c1">#TODO: check uniprots in should_update bool check too, not just version. Also organisms should be checked too.</span>
<div class="viewcode-block" id="update">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.update">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">:</span><span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">organisms</span><span class="p">:</span> <span class="nb">set</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the local BioGRID cache if a newer release is available.</span>

<span class="sd">    :param versions: List of current versions of the BioGRID database.</span>
<span class="sd">    :param uniprots_to_get: Optional set of UniProt accessions to retain.</span>
<span class="sd">    :param organisms: Optional set of NCBI TaxIDs (as strings) to retain.</span>
<span class="sd">    :returns: New version string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://downloads.thebiogrid.org/BioGRID/Release-Archive&#39;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">rr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;href=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1"> title&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">if</span> <span class="s1">&#39;https://downloads.thebiogrid.org/BioGRID/Release-Archive/&#39;</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]</span>
    <span class="n">latest</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">latest_zipname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">latest</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.org/&quot;</span><span class="p">,</span><span class="s2">&quot;.org/Download/&quot;</span><span class="p">)</span><span class="si">}{</span><span class="n">latest</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;BIOGRID&quot;</span><span class="p">,</span><span class="s2">&quot;BIOGRID-ALL&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.tab3.zip&#39;</span>
    <span class="n">uzip</span> <span class="o">=</span> <span class="n">latest_zipname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">save_location</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="n">apitools</span><span class="o">.</span><span class="n">get_save_location</span><span class="p">(</span><span class="s1">&#39;BioGRID&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">version</span> <span class="o">!=</span> <span class="n">uzip</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updating BioGRID&#39;</span><span class="p">)</span>
        <span class="n">do_update</span><span class="p">(</span><span class="n">save_location</span><span class="p">,</span> <span class="n">uzip</span><span class="p">,</span> <span class="n">latest_zipname</span><span class="p">,</span> <span class="n">uniprots_to_get</span><span class="p">,</span> <span class="n">organisms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uzip</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">version</span></div>


<div class="viewcode-block" id="get_method_annotation">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.get_method_annotation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_method_annotation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return annotations for BioGRID interaction identification methods.</span>

<span class="sd">    :returns: Mapping from method name to description text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Affinity Capture-Luminescence&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait protein, tagged with luciferase, is enzymatically detected in immunoprecipitates of the prey protein as light emission. The prey protein is affinity captured from cell extracts by either polyclonal antibody or epitope tag.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Affinity Capture-MS&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait protein is affinity captured from cell extracts by either polyclonal antibody or epitope tag and the associated interaction partner is identified by mass spectrometric methods. Note that this in an in vivo experiment where all relevant proteins are co-expressed in the cell (e.g. PMID: 12150911).&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Affinity Capture-RNA&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait protein is affinity captured from cell extracts by either polyclonal antibody or epitope tag and the associated RNA species is identified by Northern blot, RT-PCR, affinity labeling, sequencing, or microarray analysis. Note that this is an in vivo experiment where all relevant interactors are co-expressed in the cell (e.g. PMID: 10747033). If the protein-RNA interaction is detected in vitro, use Protein-RNA instead.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Affinity Capture-Western&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait protein is affinity captured from cell extracts by either polyclonal antibody or epitope tag and the associated interaction partner is identified by Western blot with a specific polyclonal antibody or second epitope tag (e.g. PMID: 11782448, Fig. 2). This category is also used if an interacting protein is visualized directly by dye stain or radioactivity. Note that this is an in vivo experiment where all relevant proteins are co-expressed in the cell. If the proteins are shown to interact outside of a cellular environment (such as lysates exposed to a bait protein for pull down) this should be considered in vitro and Reconstituted Complex should be used. This also differs from any co-purification experiment involving affinity capture in that the co-purification experiment involves at least one extra purification step to get rid of potential contaminating proteins.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Co-fractionation&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred from the presence of two or more protein subunits in a partially purified protein preparation (e.g. PMID: 11294905, Fig. 9). If co-fractionation is demonstrated between 3 or more proteins, then add them as a complex.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Co-localization&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred from two proteins that co-localize in the cell by indirect immunofluorescence only when in addition, if one gene is deleted, the other protein becomes mis-localized. This also includes co-dependent association of proteins with promoter DNA in chromatin immunoprecipitation experiments (write ChIP in qualification text box), and in situ proximity ligation assays (write PLA in qualification text box).&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Proximity Label-MS&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait-enzyme fusion protein selectively modifies a vicinal protein with a diffusible reactive product, followed by affinity capture of the modified protein and identification by mass spectrometric methods, such as the BioID system PMID: 24255178. This system should not be used for in situ proximity ligation assays in which the interaction is measured by fluorescence, eg. PMID: 25168242, which should be captured as co-localization.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Co-purification&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred from the identification of two or more protein subunits in a purified protein complex, as obtained by several classical biochemical fractionation steps, or else by affinity purification and one or more additional fractionation steps. Note that a Western or mass-spec may also be used to identify the subunits, but that this differs from Affinity Capture-Western or Affinity Capture-Mass Spec because it involves at least one extra purification step to get rid of contaminants (e.g. PMID: 19343713). Typically, TAP-tag experiments are considered to be affinity captures and not co-purification experiments. If there is no obvious bait-hit directionality to the interaction, then the co-purifying proteins should be listed as a complex. If only co-fractionation is demonstrated, i.e. if the interaction is inferred from the presence of two or more protein subunits in a partially purified protein preparation (e.g. PMID: 11294905, Fig. 9), then use Co-fractionation instead.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;FRET&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when close proximity of interaction partners is detected by fluorescence resonance energy transfer between pairs of fluorophore-labeled molecules, such as occurs between CFP (donor) and YFP (acceptor) fusion proteins in vivo (e.g. PMID: 11950888, Fig. 4).&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;PCA&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred through the use of a Protein-Fragment Complementation Assay (PCA) in which a bait protein is expressed as a fusion to either an N- or C- terminal peptide fragment of a reporter protein and a prey protein is expressed as a fusion to the complementary C- or N- terminal fragment, respectively, of the same reporter protein. Interaction of bait and prey proteins bring together complementary fragments, which can then fold into an active reporter, e.g. the split-ubiquitin assay (e.g. PMID: 12134063, Figs. 1,2), bimolecular fluorescent complementation (BiFC). More examples of PCAs are discussed in this paper.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Two-hybrid&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait protein is expressed as a DNA binding domain (DBD) fusion, a prey protein is expressed as a transcriptional activation domain (TAD) fusion and the interaction is measured by reporter gene activation (e.g. PMID: 9082982, Table 1).&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Biochemical Activity&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred from the biochemical effect of one protein upon another in vitro, for example, GTP-GDP exchange activity or phosphorylation of a substrate by a kinase (e.g. PMID: 9452439, Fig. 2). The bait protein executes the activity on the substrate hit protein. A Modification value is recorded for interactions of this type with the possible values Phosphorylation, Ubiquitination, Sumoylation, Dephosphorylation, Methylation, Prenylation, Acetylation, Deubiquitination, Proteolytic Processing, Glucosylation, Nedd(Rub1)ylation, Deacetylation, No Modification, Demethylation.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Co-crystal Structure&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is directly demonstrated at the atomic level by X-ray crystallography (e.g. PMID: 12660736). This category should also be used for NMR or Electron Microscopy (EM) structures, and for each of these cases, a note should be added indicating that it</span><span class="se">\&#39;</span><span class="s1">s an NMR or EM structure. If there is no obvious bait-hit directionality to the interaction involving 3 or more proteins, then the co-crystallized proteins should be listed as a complex.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Far Western&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred when a bait protein is immobilized on a membrane and a prey protein that is incubated with the membrane localizes to the same membrane position as the bait protein. The prey protein could be provided as a purified protein probe (e.g. PMID: 12857883, Fig. 7).&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Protein-peptide&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred between a protein and a peptide derived from an interaction partner. A variety of techniques could be employed including phage display experiments (e.g. PMID: 12706896). Depending on the experimental details, either the protein or the peptide could be the bait.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Protein-RNA&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred using a variety of techniques between a protein and an RNA in vitro. By way of contrast, note that Affinity Capture-RNA involves protein and RNA that are co-expressed in vivo.&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Reconstituted Complex&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;An interaction is inferred between proteins in vitro. This can include proteins in recombinant form or proteins isolated directly from cells with recombinant or purified bait. For example, GST pull-down assays where a GST-tagged protein is first isolated and then used to fish interactors from cell lysates are considered reconstituted complexes (e.g. PMID: 14657240, Fig. 4A or PMID: 14761940, Fig. 5). This can also include gel-shifts and surface plasmon resonance experiments. The bait-hit directionality may not be clear for 2 interacting proteins. In these cases the directionality is up to the discretion of the curator.Direction of Interactions (Bait/Hit). If there is no obvious bait-hit directionality to an interaction involving 3 or more proteins, then the proteins in the reconstituted complex should be entered as a complex. &#39;</span><span class="p">,</span> 
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">legend</span></div>


<div class="viewcode-block" id="methods_text">
<a class="viewcode-back" href="../../../../code/app.components.api_tools.html#app.components.api_tools.biogrid.methods_text">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">methods_text</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a plain-text description of the BioGRID data used.</span>

<span class="sd">    :returns: Multi-line string including source, version and citation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">short</span><span class="p">,</span><span class="n">long</span><span class="p">,</span><span class="n">pmid</span> <span class="o">=</span> <span class="n">apitools</span><span class="o">.</span><span class="n">get_pub_ref</span><span class="p">(</span><span class="s1">&#39;BioGRID&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="s1">&#39;BioGRID&#39;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">&#39;Interactions were mapped with BioGRID (https://thebiogrid.org) </span><span class="si">{</span><span class="n">short</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">pmid</span><span class="p">,</span>
        <span class="n">long</span>
    <span class="p">])</span></div>


<span class="c1"># TODO: this should not be set here.</span>
<span class="n">odir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;components&#39;</span><span class="p">,</span><span class="s1">&#39;api_tools&#39;</span><span class="p">,</span><span class="s1">&#39;annotation&#39;</span><span class="p">)</span>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kari Salokas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
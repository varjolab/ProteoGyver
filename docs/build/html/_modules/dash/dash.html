

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dash.dash &mdash; ProteoGyver Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=aaadad1f"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ProteoGyver
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code/modules.html">2025_ProteoGyver</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ProteoGyver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">dash.dash</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dash.dash</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">importlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextvars</span><span class="w"> </span><span class="kn">import</span> <span class="n">copy_context</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">importlib.machinery</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModuleSpec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">importlib.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_spec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">importlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">metadata</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pkgutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mimetypes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">flask</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">importlib_metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span> <span class="k">as</span> <span class="n">_get_distribution_version</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dash</span><span class="w"> </span><span class="kn">import</span> <span class="n">dcc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dash</span><span class="w"> </span><span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dash</span><span class="w"> </span><span class="kn">import</span> <span class="n">dash_table</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.fingerprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_fingerprint</span><span class="p">,</span> <span class="n">check_fingerprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">Scripts</span><span class="p">,</span> <span class="n">Css</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.dependencies</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Input</span><span class="p">,</span>
    <span class="n">Output</span><span class="p">,</span>
    <span class="n">State</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.development.base_component</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComponentRegistry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PreventUpdate</span><span class="p">,</span>
    <span class="n">InvalidResourceError</span><span class="p">,</span>
    <span class="n">ProxyError</span><span class="p">,</span>
    <span class="n">DuplicateCallback</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._configs</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_combined_config</span><span class="p">,</span> <span class="n">pathname_configs</span><span class="p">,</span> <span class="n">pages_folder_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AttributeDict</span><span class="p">,</span>
    <span class="n">format_tag</span><span class="p">,</span>
    <span class="n">generate_hash</span><span class="p">,</span>
    <span class="n">inputs_to_dict</span><span class="p">,</span>
    <span class="n">inputs_to_vals</span><span class="p">,</span>
    <span class="n">interpolate_str</span><span class="p">,</span>
    <span class="n">patch_collections_abc</span><span class="p">,</span>
    <span class="n">split_callback_id</span><span class="p">,</span>
    <span class="n">to_json</span><span class="p">,</span>
    <span class="n">convert_to_AttributeDict</span><span class="p">,</span>
    <span class="n">gen_salt</span><span class="p">,</span>
    <span class="n">hooks_to_js_object</span><span class="p">,</span>
    <span class="n">parse_version</span><span class="p">,</span>
    <span class="n">get_caller_name</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_callback</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_get_paths</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_dash_renderer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_validate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_watch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_get_app</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">._grouping</span><span class="w"> </span><span class="kn">import</span> <span class="n">map_grouping</span><span class="p">,</span> <span class="n">grouping_len</span><span class="p">,</span> <span class="n">update_args_group</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._obsolete</span><span class="w"> </span><span class="kn">import</span> <span class="n">ObsoleteChecker</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">_pages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._pages</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_parse_query_string</span><span class="p">,</span>
    <span class="n">_page_meta_tags</span><span class="p">,</span>
    <span class="n">_path_to_page</span><span class="p">,</span>
    <span class="n">_import_layouts_from_pages</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">._jupyter</span><span class="w"> </span><span class="kn">import</span> <span class="n">jupyter_dash</span><span class="p">,</span> <span class="n">JupyterDisplayMode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">RendererHooks</span>

<span class="n">RouteCallable</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

<span class="c1"># If dash_design_kit is installed, check for version</span>
<span class="n">ddk_version</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;dash_design_kit&quot;</span><span class="p">):</span>
    <span class="n">ddk_version</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;dash_design_kit&quot;</span><span class="p">)</span>

<span class="n">plotly_version</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;plotly&quot;</span><span class="p">):</span>
    <span class="n">plotly_version</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s2">&quot;plotly&quot;</span><span class="p">)</span>

<span class="c1"># Add explicit mapping for map files</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="s2">&quot;.map&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">_default_index</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">    &lt;head&gt;</span>
<span class="s2">        {%metas%}</span>
<span class="s2">        &lt;title&gt;{%title%}&lt;/title&gt;</span>
<span class="s2">        {</span><span class="si">%f</span><span class="s2">avicon%}</span>
<span class="s2">        {</span><span class="si">%c</span><span class="s2">ss%}</span>
<span class="s2">    &lt;/head&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;!--[if IE]&gt;&lt;script&gt;</span>
<span class="s2">        alert(&quot;Dash v2.7+ does not support Internet Explorer. Please use a newer browser.&quot;);</span>
<span class="s2">        &lt;/script&gt;&lt;![endif]--&gt;</span>
<span class="s2">        {</span><span class="si">%a</span><span class="s2">pp_entry%}</span>
<span class="s2">        &lt;footer&gt;</span>
<span class="s2">            {</span><span class="si">%c</span><span class="s2">onfig%}</span>
<span class="s2">            {</span><span class="si">%s</span><span class="s2">cripts%}</span>
<span class="s2">            {</span><span class="si">%r</span><span class="s2">enderer%}</span>
<span class="s2">        &lt;/footer&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;&quot;&quot;&quot;</span>

<span class="n">_app_entry</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;div id=&quot;react-entry-point&quot;&gt;</span>
<span class="s2">    &lt;div class=&quot;_dash-loading&quot;&gt;</span>
<span class="s2">        Loading...</span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">&lt;/div&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_re_index_entry</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="si">%a</span><span class="s2">pp_entry%}&quot;</span><span class="p">,</span> <span class="s2">&quot;{</span><span class="si">%a</span><span class="s2">pp_entry%}&quot;</span>
<span class="n">_re_index_config</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="si">%c</span><span class="s2">onfig%}&quot;</span><span class="p">,</span> <span class="s2">&quot;{</span><span class="si">%c</span><span class="s2">onfig%}&quot;</span>
<span class="n">_re_index_scripts</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="si">%s</span><span class="s2">cripts%}&quot;</span><span class="p">,</span> <span class="s2">&quot;{</span><span class="si">%s</span><span class="s2">cripts%}&quot;</span>

<span class="n">_re_index_entry_id</span> <span class="o">=</span> <span class="s1">&#39;id=&quot;react-entry-point&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;#react-entry-point&quot;</span>
<span class="n">_re_index_config_id</span> <span class="o">=</span> <span class="s1">&#39;id=&quot;_dash-config&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;#_dash-config&quot;</span>
<span class="n">_re_index_scripts_id</span> <span class="o">=</span> <span class="s1">&#39;src=&quot;[^&quot;]*dash[-_]renderer[^&quot;]*&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;dash-renderer&quot;</span>
<span class="n">_re_renderer_scripts_id</span> <span class="o">=</span> <span class="s1">&#39;id=&quot;_dash-renderer&#39;</span><span class="p">,</span> <span class="s2">&quot;new DashRenderer&quot;</span>


<span class="n">_ID_CONTENT</span> <span class="o">=</span> <span class="s2">&quot;_pages_content&quot;</span>
<span class="n">_ID_LOCATION</span> <span class="o">=</span> <span class="s2">&quot;_pages_location&quot;</span>
<span class="n">_ID_STORE</span> <span class="o">=</span> <span class="s2">&quot;_pages_store&quot;</span>
<span class="n">_ID_DUMMY</span> <span class="o">=</span> <span class="s2">&quot;_pages_dummy&quot;</span>

<span class="n">DASH_VERSION_URL</span> <span class="o">=</span> <span class="s2">&quot;https://dash-version.plotly.com:8080/current_version&quot;</span>

<span class="c1"># Handles the case in a newly cloned environment where the components are not yet generated.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">page_container</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Location</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_ID_LOCATION</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="s2">&quot;callback-nav&quot;</span><span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_ID_CONTENT</span><span class="p">,</span> <span class="n">disable_n_clicks</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_ID_STORE</span><span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_ID_DUMMY</span><span class="p">,</span> <span class="n">disable_n_clicks</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="c1"># pylint: disable-next=bare-except</span>
<span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
    <span class="n">page_container</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_traceback</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># pylint: disable=import-outside-toplevel</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.debug</span><span class="w"> </span><span class="kn">import</span> <span class="n">tbtools</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">tbtools</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_skip</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">dash._callback</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
            <span class="n">_invoke_callback</span><span class="p">,</span>
            <span class="n">_async_invoke_callback</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">tb</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skip</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_next</span>
            <span class="k">if</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_frame</span><span class="o">.</span><span class="n">f_code</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">_invoke_callback</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span>
                <span class="n">_async_invoke_callback</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">return</span> <span class="n">skip</span>

        <span class="k">return</span> <span class="n">skip</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_do_skip</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">dash._callback</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
            <span class="n">_invoke_callback</span><span class="p">,</span>
            <span class="n">_async_invoke_callback</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">tb</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">__traceback__</span>
        <span class="k">while</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_frame</span><span class="o">.</span><span class="n">f_code</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">_invoke_callback</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span>
                <span class="n">_async_invoke_callback</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">return</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_next</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_next</span>
        <span class="k">return</span> <span class="n">error</span><span class="o">.</span><span class="n">__traceback__</span>

    <span class="c1"># werkzeug&lt;2.1.0</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tbtools</span><span class="p">,</span> <span class="s2">&quot;get_current_traceback&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tbtools</span><span class="o">.</span><span class="n">get_current_traceback</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">skip</span><span class="o">=</span><span class="n">_get_skip</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">render_full</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tbtools</span><span class="p">,</span> <span class="s2">&quot;DebugTraceback&quot;</span><span class="p">):</span>
        <span class="c1"># pylint: disable=no-member</span>
        <span class="k">return</span> <span class="n">tbtools</span><span class="o">.</span><span class="n">DebugTraceback</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">error</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">_get_skip</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">render_debugger_html</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">error</span><span class="p">,</span> <span class="n">_do_skip</span><span class="p">(</span><span class="n">error</span><span class="p">)))</span>


<span class="c1"># Singleton signal to not update an output, alternative to PreventUpdate</span>
<span class="n">no_update</span> <span class="o">=</span> <span class="n">_callback</span><span class="o">.</span><span class="n">NoUpdate</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_async_function</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Check if the function is a coroutine function</span>
    <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># If the function is not a coroutine, call it directly</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1"># pylint: disable=too-many-instance-attributes</span>
<span class="c1"># pylint: disable=too-many-arguments, too-many-locals</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Dash</span><span class="p">(</span><span class="n">ObsoleteChecker</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dash is a framework for building analytical web applications.</span>
<span class="sd">    No JavaScript required.</span>

<span class="sd">    If a parameter can be set by an environment variable, that is listed as:</span>
<span class="sd">        env: ``DASH_****``</span>
<span class="sd">    Values provided here take precedence over environment variables.</span>

<span class="sd">    :param name: The name Flask should use for your app. Even if you provide</span>
<span class="sd">        your own ``server``, ``name`` will be used to help find assets.</span>
<span class="sd">        Typically ``__name__`` (the magic global var, not a string) is the</span>
<span class="sd">        best value to use. Default ``&#39;__main__&#39;``, env: ``DASH_APP_NAME``</span>
<span class="sd">    :type name: string</span>

<span class="sd">    :param server: Sets the Flask server for your app. There are three options:</span>
<span class="sd">        ``True`` (default): Dash will create a new server</span>
<span class="sd">        ``False``: The server will be added later via ``app.init_app(server)``</span>
<span class="sd">            where ``server`` is a ``flask.Flask`` instance.</span>
<span class="sd">        ``flask.Flask``: use this pre-existing Flask server.</span>
<span class="sd">    :type server: boolean or flask.Flask</span>

<span class="sd">    :param assets_folder: a path, relative to the current working directory,</span>
<span class="sd">        for extra files to be used in the browser. Default ``&#39;assets&#39;``.</span>
<span class="sd">        All .js and .css files will be loaded immediately unless excluded by</span>
<span class="sd">        ``assets_ignore``, and other files such as images will be served if</span>
<span class="sd">        requested.</span>
<span class="sd">    :type assets_folder: string</span>

<span class="sd">    :param pages_folder: a relative or absolute path for pages of a multi-page app.</span>
<span class="sd">        Default ``&#39;pages&#39;``.</span>
<span class="sd">    :type pages_folder: string or pathlib.Path</span>

<span class="sd">    :param use_pages: When True, the ``pages`` feature for multi-page apps is</span>
<span class="sd">        enabled. If you set a non-default ``pages_folder`` this will be inferred</span>
<span class="sd">        to be True. Default `None`.</span>
<span class="sd">    :type use_pages: boolean</span>

<span class="sd">    :param include_pages_meta: Include the page meta tags for twitter cards.</span>
<span class="sd">    :type include_pages_meta: bool</span>

<span class="sd">    :param assets_url_path: The local urls for assets will be:</span>
<span class="sd">        ``requests_pathname_prefix + assets_url_path + &#39;/&#39; + asset_path``</span>
<span class="sd">        where ``asset_path`` is the path to a file inside ``assets_folder``.</span>
<span class="sd">        Default ``&#39;assets&#39;``.</span>
<span class="sd">    :type asset_url_path: string</span>

<span class="sd">    :param assets_ignore: A regex, as a string to pass to ``re.compile``, for</span>
<span class="sd">        assets to omit from immediate loading. Ignored files will still be</span>
<span class="sd">        served if specifically requested. You cannot use this to prevent access</span>
<span class="sd">        to sensitive files.</span>
<span class="sd">    :type assets_ignore: string</span>

<span class="sd">    :param assets_path_ignore: A list of regex, each regex as a string to pass to ``re.compile``, for</span>
<span class="sd">        assets path to omit from immediate loading. The files in these ignored paths will still be</span>
<span class="sd">        served if specifically requested. You cannot use this to prevent access</span>
<span class="sd">        to sensitive files.</span>
<span class="sd">    :type assets_path_ignore: list of strings</span>

<span class="sd">    :param assets_external_path: an absolute URL from which to load assets.</span>
<span class="sd">        Use with ``serve_locally=False``. assets_external_path is joined</span>
<span class="sd">        with assets_url_path to determine the absolute url to the</span>
<span class="sd">        asset folder. Dash can still find js and css to automatically load</span>
<span class="sd">        if you also keep local copies in your assets folder that Dash can index,</span>
<span class="sd">        but external serving can improve performance and reduce load on</span>
<span class="sd">        the Dash server.</span>
<span class="sd">        env: ``DASH_ASSETS_EXTERNAL_PATH``</span>
<span class="sd">    :type assets_external_path: string</span>

<span class="sd">    :param include_assets_files: Default ``True``, set to ``False`` to prevent</span>
<span class="sd">        immediate loading of any assets. Assets will still be served if</span>
<span class="sd">        specifically requested. You cannot use this to prevent access</span>
<span class="sd">        to sensitive files. env: ``DASH_INCLUDE_ASSETS_FILES``</span>
<span class="sd">    :type include_assets_files: boolean</span>

<span class="sd">    :param url_base_pathname: A local URL prefix to use app-wide.</span>
<span class="sd">        Default ``&#39;/&#39;``. Both `requests_pathname_prefix` and</span>
<span class="sd">        `routes_pathname_prefix` default to `url_base_pathname`.</span>
<span class="sd">        env: ``DASH_URL_BASE_PATHNAME``</span>
<span class="sd">    :type url_base_pathname: string</span>

<span class="sd">    :param requests_pathname_prefix: A local URL prefix for file requests.</span>
<span class="sd">        Defaults to `url_base_pathname`, and must end with</span>
<span class="sd">        `routes_pathname_prefix`. env: ``DASH_REQUESTS_PATHNAME_PREFIX``</span>
<span class="sd">    :type requests_pathname_prefix: string</span>

<span class="sd">    :param routes_pathname_prefix: A local URL prefix for JSON requests.</span>
<span class="sd">        Defaults to ``url_base_pathname``, and must start and end</span>
<span class="sd">        with ``&#39;/&#39;``. env: ``DASH_ROUTES_PATHNAME_PREFIX``</span>
<span class="sd">    :type routes_pathname_prefix: string</span>

<span class="sd">    :param serve_locally: If ``True`` (default), assets and dependencies</span>
<span class="sd">        (Dash and Component js and css) will be served from local URLs.</span>
<span class="sd">        If ``False`` we will use CDN links where available.</span>
<span class="sd">    :type serve_locally: boolean</span>

<span class="sd">    :param compress: Use gzip to compress files and data served by Flask.</span>
<span class="sd">        To use this option, you need to install dash[compress]</span>
<span class="sd">        Default ``False``</span>
<span class="sd">    :type compress: boolean</span>

<span class="sd">    :param meta_tags: html &lt;meta&gt; tags to be added to the index page.</span>
<span class="sd">        Each dict should have the attributes and values for one tag, eg:</span>
<span class="sd">        ``{&#39;name&#39;: &#39;description&#39;, &#39;content&#39;: &#39;My App&#39;}``</span>
<span class="sd">    :type meta_tags: list of dicts</span>

<span class="sd">    :param index_string: Override the standard Dash index page.</span>
<span class="sd">        Must contain the correct insertion markers to interpolate various</span>
<span class="sd">        content into it depending on the app config and components used.</span>
<span class="sd">        See https://dash.plotly.com/external-resources for details.</span>
<span class="sd">    :type index_string: string</span>

<span class="sd">    :param external_scripts: Additional JS files to load with the page.</span>
<span class="sd">        Each entry can be a string (the URL) or a dict with ``src`` (the URL)</span>
<span class="sd">        and optionally other ``&lt;script&gt;`` tag attributes such as ``integrity``</span>
<span class="sd">        and ``crossorigin``.</span>
<span class="sd">    :type external_scripts: list of strings or dicts</span>

<span class="sd">    :param external_stylesheets: Additional CSS files to load with the page.</span>
<span class="sd">        Each entry can be a string (the URL) or a dict with ``href`` (the URL)</span>
<span class="sd">        and optionally other ``&lt;link&gt;`` tag attributes such as ``rel``,</span>
<span class="sd">        ``integrity`` and ``crossorigin``.</span>
<span class="sd">    :type external_stylesheets: list of strings or dicts</span>

<span class="sd">    :param suppress_callback_exceptions: Default ``False``: check callbacks to</span>
<span class="sd">        ensure referenced IDs exist and props are valid. Set to ``True``</span>
<span class="sd">        if your layout is dynamic, to bypass these checks.</span>
<span class="sd">        env: ``DASH_SUPPRESS_CALLBACK_EXCEPTIONS``</span>
<span class="sd">    :type suppress_callback_exceptions: boolean</span>

<span class="sd">    :param prevent_initial_callbacks: Default ``False``: Sets the default value</span>
<span class="sd">        of ``prevent_initial_call`` for all callbacks added to the app.</span>
<span class="sd">        Normally all callbacks are fired when the associated outputs are first</span>
<span class="sd">        added to the page. You can disable this for individual callbacks by</span>
<span class="sd">        setting ``prevent_initial_call`` in their definitions, or set it</span>
<span class="sd">        ``True`` here in which case you must explicitly set it ``False`` for</span>
<span class="sd">        those callbacks you wish to have an initial call. This setting has no</span>
<span class="sd">        effect on triggering callbacks when their inputs change later on.</span>

<span class="sd">    :param show_undo_redo: Default ``False``, set to ``True`` to enable undo</span>
<span class="sd">        and redo buttons for stepping through the history of the app state.</span>
<span class="sd">    :type show_undo_redo: boolean</span>

<span class="sd">    :param extra_hot_reload_paths: A list of paths to watch for changes, in</span>
<span class="sd">        addition to assets and known Python and JS code, if hot reloading is</span>
<span class="sd">        enabled.</span>
<span class="sd">    :type extra_hot_reload_paths: list of strings</span>

<span class="sd">    :param plugins: Extend Dash functionality by passing a list of objects</span>
<span class="sd">        with a ``plug`` method, taking a single argument: this app, which will</span>
<span class="sd">        be called after the Flask server is attached.</span>
<span class="sd">    :type plugins: list of objects</span>

<span class="sd">    :param title: Default ``Dash``. Configures the document.title</span>
<span class="sd">    (the text that appears in a browser tab).</span>

<span class="sd">    :param update_title: Default ``Updating...``. Configures the document.title</span>
<span class="sd">    (the text that appears in a browser tab) text when a callback is being run.</span>
<span class="sd">    Set to None or &#39;&#39; if you don&#39;t want the document.title to change or if you</span>
<span class="sd">    want to control the document.title through a separate component or</span>
<span class="sd">    clientside callback.</span>

<span class="sd">    :param background_callback_manager: Background callback manager instance</span>
<span class="sd">        to support the ``@callback(..., background=True)`` decorator.</span>
<span class="sd">        One of ``DiskcacheManager`` or ``CeleryManager`` currently supported.</span>

<span class="sd">    :param add_log_handler: Automatically add a StreamHandler to the app logger</span>
<span class="sd">        if not added previously.</span>

<span class="sd">    :param hooks: Extend Dash renderer functionality by passing a dictionary of</span>
<span class="sd">    javascript functions. To hook into the layout, use dict keys &quot;layout_pre&quot; and</span>
<span class="sd">    &quot;layout_post&quot;. To hook into the callbacks, use keys &quot;request_pre&quot; and &quot;request_post&quot;</span>

<span class="sd">    :param routing_callback_inputs: When using Dash pages (use_pages=True), allows to</span>
<span class="sd">    add new States to the routing callback, to pass additional data to the layout</span>
<span class="sd">    functions. The syntax for this parameter is a dict of State objects:</span>
<span class="sd">    `routing_callback_inputs={&quot;language&quot;: Input(&quot;language&quot;, &quot;value&quot;)}`</span>
<span class="sd">    NOTE: the keys &quot;pathname_&quot; and &quot;search_&quot; are reserved for internal use.</span>

<span class="sd">    :param description:  Sets a default description for meta tags on Dash pages (use_pages=True).</span>

<span class="sd">    :param on_error: Global callback error handler to call when</span>
<span class="sd">        an exception is raised. Receives the exception object as first argument.</span>
<span class="sd">        The callback_context can be used to access the original callback inputs,</span>
<span class="sd">        states and output.</span>

<span class="sd">    :param use_async: When True, the app will create async endpoints, as a dev,</span>
<span class="sd">        they will be responsible for installing the `flask[async]` dependency.</span>
<span class="sd">    :type use_async: boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_plotlyjs_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">STARTUP_ROUTES</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">server</span><span class="p">:</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span>

    <span class="c1"># Layout is a complex type which can be many things</span>
    <span class="n">_layout</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">_extra_components</span><span class="p">:</span> <span class="n">Any</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-statements</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">server</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">assets_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;assets&quot;</span><span class="p">,</span>
        <span class="n">pages_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pages&quot;</span><span class="p">,</span>
        <span class="n">use_pages</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">assets_url_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;assets&quot;</span><span class="p">,</span>
        <span class="n">assets_ignore</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">assets_path_ignore</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">assets_external_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">eager_loading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">include_assets_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">include_pages_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">url_base_pathname</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">requests_pathname_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">routes_pathname_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">serve_locally</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">compress</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">meta_tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index_string</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_default_index</span><span class="p">,</span>
        <span class="n">external_scripts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">external_stylesheets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">suppress_callback_exceptions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prevent_initial_callbacks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_undo_redo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">extra_hot_reload_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plugins</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Dash&quot;</span><span class="p">,</span>
        <span class="n">update_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Updating...&quot;</span><span class="p">,</span>
        <span class="n">background_callback_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Any</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Type should be specified if possible</span>
        <span class="n">add_log_handler</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">hooks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RendererHooks</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">routing_callback_inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Input</span><span class="p">,</span> <span class="n">State</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="ne">Exception</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_async</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">obsolete</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="n">use_async</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">asgiref</span>  <span class="c1"># pylint: disable=unused-import, import-outside-toplevel # noqa</span>

                <span class="n">use_async</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">use_async</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">asgiref</span>  <span class="c1"># pylint: disable=unused-import, import-outside-toplevel # noqa</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;You are trying to use dash[async] without having installed the requirements please install via: `pip install dash[async]`&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="n">_validate</span><span class="o">.</span><span class="n">check_obsolete</span><span class="p">(</span><span class="n">obsolete</span><span class="p">)</span>

        <span class="n">caller_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">get_caller_name</span><span class="p">()</span>

        <span class="c1"># We have 3 cases: server is either True (we create the server), False</span>
        <span class="c1"># (defer server creation) or a Flask app instance (we use their server)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">caller_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">caller_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="n">caller_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">server</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;server must be a Flask app or a boolean&quot;</span><span class="p">)</span>

        <span class="n">base_prefix</span><span class="p">,</span> <span class="n">routes_prefix</span><span class="p">,</span> <span class="n">requests_prefix</span> <span class="o">=</span> <span class="n">pathname_configs</span><span class="p">(</span>
            <span class="n">url_base_pathname</span><span class="p">,</span> <span class="n">routes_pathname_prefix</span><span class="p">,</span> <span class="n">requests_pathname_prefix</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">caller_name</span><span class="p">,</span>
            <span class="n">assets_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">flask</span><span class="o">.</span><span class="n">helpers</span><span class="o">.</span><span class="n">get_root_path</span><span class="p">(</span><span class="n">caller_name</span><span class="p">),</span> <span class="n">assets_folder</span>
            <span class="p">),</span>  <span class="c1"># type: ignore</span>
            <span class="n">assets_url_path</span><span class="o">=</span><span class="n">assets_url_path</span><span class="p">,</span>
            <span class="n">assets_ignore</span><span class="o">=</span><span class="n">assets_ignore</span><span class="p">,</span>
            <span class="n">assets_path_ignore</span><span class="o">=</span><span class="n">assets_path_ignore</span><span class="p">,</span>
            <span class="n">assets_external_path</span><span class="o">=</span><span class="n">get_combined_config</span><span class="p">(</span>
                <span class="s2">&quot;assets_external_path&quot;</span><span class="p">,</span> <span class="n">assets_external_path</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="p">),</span>
            <span class="n">pages_folder</span><span class="o">=</span><span class="n">pages_folder_config</span><span class="p">(</span><span class="n">caller_name</span><span class="p">,</span> <span class="n">pages_folder</span><span class="p">,</span> <span class="n">use_pages</span><span class="p">),</span>
            <span class="n">eager_loading</span><span class="o">=</span><span class="n">eager_loading</span><span class="p">,</span>
            <span class="n">include_assets_files</span><span class="o">=</span><span class="n">get_combined_config</span><span class="p">(</span>
                <span class="s2">&quot;include_assets_files&quot;</span><span class="p">,</span> <span class="n">include_assets_files</span><span class="p">,</span> <span class="kc">True</span>
            <span class="p">),</span>
            <span class="n">url_base_pathname</span><span class="o">=</span><span class="n">base_prefix</span><span class="p">,</span>
            <span class="n">routes_pathname_prefix</span><span class="o">=</span><span class="n">routes_prefix</span><span class="p">,</span>
            <span class="n">requests_pathname_prefix</span><span class="o">=</span><span class="n">requests_prefix</span><span class="p">,</span>
            <span class="n">serve_locally</span><span class="o">=</span><span class="n">serve_locally</span><span class="p">,</span>
            <span class="n">compress</span><span class="o">=</span><span class="n">get_combined_config</span><span class="p">(</span><span class="s2">&quot;compress&quot;</span><span class="p">,</span> <span class="n">compress</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">meta_tags</span><span class="o">=</span><span class="n">meta_tags</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">external_scripts</span><span class="o">=</span><span class="n">external_scripts</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">external_stylesheets</span><span class="o">=</span><span class="n">external_stylesheets</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">suppress_callback_exceptions</span><span class="o">=</span><span class="n">get_combined_config</span><span class="p">(</span>
                <span class="s2">&quot;suppress_callback_exceptions&quot;</span><span class="p">,</span> <span class="n">suppress_callback_exceptions</span><span class="p">,</span> <span class="kc">False</span>
            <span class="p">),</span>
            <span class="n">prevent_initial_callbacks</span><span class="o">=</span><span class="n">prevent_initial_callbacks</span><span class="p">,</span>
            <span class="n">show_undo_redo</span><span class="o">=</span><span class="n">show_undo_redo</span><span class="p">,</span>
            <span class="n">extra_hot_reload_paths</span><span class="o">=</span><span class="n">extra_hot_reload_paths</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">update_title</span><span class="o">=</span><span class="n">update_title</span><span class="p">,</span>
            <span class="n">include_pages_meta</span><span class="o">=</span><span class="n">include_pages_meta</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set_read_only</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;assets_folder&quot;</span><span class="p">,</span>
                <span class="s2">&quot;assets_url_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eager_loading&quot;</span><span class="p">,</span>
                <span class="s2">&quot;serve_locally&quot;</span><span class="p">,</span>
                <span class="s2">&quot;compress&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pages_folder&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;Read-only: can only be set in the Dash constructor&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span>
            <span class="s2">&quot;Invalid config key. Some settings are only available &quot;</span>
            <span class="s2">&quot;via the Dash constructor&quot;</span>
        <span class="p">)</span>

        <span class="n">_get_paths</span><span class="o">.</span><span class="n">CONFIG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="n">_pages</span><span class="o">.</span><span class="n">CONFIG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pages_folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pages_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_pages</span> <span class="o">=</span> <span class="p">(</span><span class="n">pages_folder</span> <span class="o">!=</span> <span class="s2">&quot;pages&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">use_pages</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">use_pages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routing_callback_inputs</span> <span class="o">=</span> <span class="n">routing_callback_inputs</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># keep title as a class property for backwards compatibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

        <span class="c1"># list of dependencies - this one is used by the back end for dispatching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># same deps as a list to catch duplicate outputs, and to send to the front end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callback_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># list of inline scripts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># index_string has special setter so can&#39;t go in config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_string</span> <span class="o">=</span> <span class="n">index_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_favicon</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># default renderer string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;var renderer = new DashRenderer(</span><span class="si">{</span><span class="n">hooks_to_js_object</span><span class="p">(</span><span class="n">hooks</span><span class="p">)</span><span class="si">}</span><span class="s2">);&quot;</span>

        <span class="c1"># static files from the packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">Css</span><span class="p">(</span><span class="n">serve_locally</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span> <span class="o">=</span> <span class="n">Scripts</span><span class="p">(</span><span class="n">serve_locally</span><span class="p">,</span> <span class="n">eager_loading</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">registered_paths</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="c1"># urls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_is_function</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span> <span class="o">=</span> <span class="n">on_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_async</span> <span class="o">=</span> <span class="n">use_async</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_dev_tools</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hot_reload</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">(</span>
            <span class="nb">hash</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">hard</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">lock</span><span class="o">=</span><span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">(),</span>
            <span class="n">watch_thread</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">changed_assets</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_assets_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_background_manager</span> <span class="o">=</span> <span class="n">background_callback_manager</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span> <span class="ow">and</span> <span class="n">add_log_handler</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">plugins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">plugins</span><span class="p">,</span> <span class="n">patch_collections_abc</span><span class="p">(</span><span class="s2">&quot;Iterable&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
                <span class="n">plugin</span><span class="o">.</span><span class="n">plug</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_hooks</span><span class="p">()</span>

        <span class="c1"># tracks internally if a function already handled at least one request.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pages&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;setup_server&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_app</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;JupyterDash&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;JupyterDash is deprecated, use Dash instead.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;See https://dash.plotly.com/dash-in-jupyter for more details.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_startup_routes</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># pylint: disable=import-outside-toplevel,protected-access</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">._hooks</span><span class="w"> </span><span class="kn">import</span> <span class="n">HooksManager</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="o">=</span> <span class="n">HooksManager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">register_setuptools</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">setup</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">):</span>
            <span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">):</span>
            <span class="n">callback_args</span><span class="p">,</span> <span class="n">callback_kwargs</span> <span class="o">=</span> <span class="n">hook</span><span class="o">.</span><span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">callback_args</span><span class="p">,</span> <span class="o">**</span><span class="n">callback_kwargs</span><span class="p">)(</span><span class="n">hook</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span>
            <span class="n">clientside_function</span><span class="p">,</span>
            <span class="n">args</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">_clientside_callbacks</span><span class="p">:</span>
            <span class="n">_callback</span><span class="o">.</span><span class="n">register_clientside_callback</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_callback_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">prevent_initial_callbacks</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span><span class="p">,</span>
                <span class="n">clientside_function</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">HookErrorHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the parts of Dash that require a flask app.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>

        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_read_only</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;url_base_pathname&quot;</span><span class="p">,</span>
                <span class="s2">&quot;routes_pathname_prefix&quot;</span><span class="p">,</span>
                <span class="s2">&quot;requests_pathname_prefix&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;Read-only: can only be set in the Dash constructor or during init_app()&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">app</span>

        <span class="n">bp_prefix</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">routes_pathname_prefix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">assets_blueprint_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bp_prefix</span><span class="si">}</span><span class="s2">dash_assets&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span>
            <span class="n">flask</span><span class="o">.</span><span class="n">Blueprint</span><span class="p">(</span>
                <span class="n">assets_blueprint_name</span><span class="p">,</span>
                <span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">static_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_folder</span><span class="p">,</span>
                <span class="n">static_url_path</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">routes_pathname_prefix</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_url_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">compress</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># pylint: disable=import-outside-toplevel</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">flask_compress</span><span class="w"> </span><span class="kn">import</span> <span class="n">Compress</span>  <span class="c1"># type: ignore[reportMissingImports]</span>

                <span class="c1"># gzip</span>
                <span class="n">Compress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>

                <span class="n">_flask_compress_version</span> <span class="o">=</span> <span class="n">parse_version</span><span class="p">(</span>
                    <span class="n">_get_distribution_version</span><span class="p">(</span><span class="s2">&quot;flask_compress&quot;</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;COMPRESS_ALGORITHM&quot;</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="n">_flask_compress_version</span> <span class="o">&gt;=</span> <span class="n">parse_version</span><span class="p">(</span><span class="s2">&quot;1.6.0&quot;</span><span class="p">):</span>
                    <span class="c1"># flask-compress==1.6.0 changed default to [&#39;br&#39;, &#39;gzip&#39;]</span>
                    <span class="c1"># and non-overridable default compression with Brotli is</span>
                    <span class="c1"># causing performance issues</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;COMPRESS_ALGORITHM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gzip&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                    <span class="s2">&quot;To use the compress option, you need to install dash[compress]&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">error</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">PreventUpdate</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_handle_error</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Handle a halted callback and return an empty 204 response.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">204</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">before_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setup_server</span><span class="p">)</span>

        <span class="c1"># add a handler for components suites errors to return 404</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">InvalidResourceError</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_invalid_resources_handler</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_routes</span><span class="p">()</span>

        <span class="n">_get_app</span><span class="o">.</span><span class="n">APP</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_pages</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_plotlyjs</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">view_func</span><span class="p">:</span> <span class="n">RouteCallable</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">full_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">routes_pathname_prefix</span> <span class="o">+</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span>
            <span class="n">full_name</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">full_name</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># record the url in Dash.routes so that it can be accessed later</span>
        <span class="c1"># e.g. for adding authentication with flask_login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span>
            <span class="s2">&quot;_dash-component-suites/&lt;string:package_name&gt;/&lt;path:fingerprinted_path&gt;&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serve_component_suites</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;_dash-layout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">serve_layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;_dash-dependencies&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_async</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;_dash-update-component&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_dispatch</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;_dash-update-component&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;_reload-hash&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">serve_reload_hash</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;_favicon.ico&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serve_default_favicon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span>
                <span class="s2">&quot;_alive_&quot;</span> <span class="o">+</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">alive_token</span><span class="p">,</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">serve_alive</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;routes&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="n">hook</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">hook</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">hook</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;methods&quot;</span><span class="p">])</span>

        <span class="c1"># catch-all for front-end routes, used by dcc.Location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="s2">&quot;&lt;path:path&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_plotlyjs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># pylint: disable=import-outside-toplevel</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">plotly.offline</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_plotlyjs_version</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://cdn.plot.ly/plotly-</span><span class="si">{</span><span class="n">get_plotlyjs_version</span><span class="p">()</span><span class="si">}</span><span class="s2">.min.js&quot;</span>

        <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">_js_dist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;relative_package_path&quot;</span><span class="p">:</span> <span class="s2">&quot;package_data/plotly.min.js&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;external_url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;plotly&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;async&quot;</span><span class="p">:</span> <span class="s2">&quot;eager&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotlyjs_url</span> <span class="o">=</span> <span class="n">url</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span>

    <span class="nd">@layout</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="n">_validate</span><span class="o">.</span><span class="n">validate_layout_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_is_function</span> <span class="o">=</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># for using flask.has_request_context() to deliver a full layout for</span>
        <span class="c1"># validation inside a layout function - track if a user might be doing this.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_layout_is_function</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suppress_callback_exceptions</span>
        <span class="p">):</span>
            <span class="n">layout_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_value</span><span class="p">()</span>
            <span class="n">_validate</span><span class="o">.</span><span class="n">validate_layout</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">layout_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span> <span class="o">=</span> <span class="n">layout_value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_layout_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_is_function</span><span class="p">:</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="p">()</span>  <span class="c1"># type: ignore[reportOptionalCall]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span>

        <span class="c1"># Add any extra components</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_components</span><span class="p">:</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_components</span><span class="p">)</span>  <span class="c1"># type: ignore[reportArgumentType]</span>

        <span class="k">return</span> <span class="n">layout</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">index_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_string</span>

    <span class="nd">@index_string</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">index_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">(</span><span class="n">_re_index_entry</span><span class="p">,</span> <span class="n">_re_index_config</span><span class="p">,</span> <span class="n">_re_index_scripts</span><span class="p">)</span>
        <span class="n">_validate</span><span class="o">.</span><span class="n">validate_index</span><span class="p">(</span><span class="s2">&quot;index string&quot;</span><span class="p">,</span> <span class="n">checks</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_string</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serve_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_value</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">):</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

        <span class="c1"># TODO - Set browser cache limit - pass hash into frontend</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
            <span class="n">to_json</span><span class="p">(</span><span class="n">layout</span><span class="p">),</span>
            <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># pieces of config needed by the front end</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;url_base_pathname&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_base_pathname</span><span class="p">,</span>
            <span class="s2">&quot;requests_pathname_prefix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requests_pathname_prefix</span><span class="p">,</span>
            <span class="s2">&quot;ui&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span>
            <span class="s2">&quot;props_check&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">props_check</span><span class="p">,</span>
            <span class="s2">&quot;disable_version_check&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">disable_version_check</span><span class="p">,</span>
            <span class="s2">&quot;show_undo_redo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">show_undo_redo</span><span class="p">,</span>
            <span class="s2">&quot;suppress_callback_exceptions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suppress_callback_exceptions</span><span class="p">,</span>
            <span class="s2">&quot;update_title&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update_title</span><span class="p">,</span>
            <span class="s2">&quot;children_props&quot;</span><span class="p">:</span> <span class="n">ComponentRegistry</span><span class="o">.</span><span class="n">children_props</span><span class="p">,</span>
            <span class="s2">&quot;serve_locally&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">serve_locally</span><span class="p">,</span>
            <span class="s2">&quot;dash_version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;dash_version_url&quot;</span><span class="p">:</span> <span class="n">DASH_VERSION_URL</span><span class="p">,</span>
            <span class="s2">&quot;ddk_version&quot;</span><span class="p">:</span> <span class="n">ddk_version</span><span class="p">,</span>
            <span class="s2">&quot;plotly_version&quot;</span><span class="p">:</span> <span class="n">plotly_version</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">serve_locally</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;plotlyjs_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotlyjs_url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">hot_reload</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;hot_reload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># convert from seconds to msec as used by js `setInterval`</span>
                <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">hot_reload_interval</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
                <span class="s2">&quot;max_retry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">hot_reload_max_retry</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suppress_callback_exceptions</span><span class="p">:</span>
            <span class="n">validation_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span>

            <span class="c1"># Add extra components</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_components</span><span class="p">:</span>
                <span class="n">validation_layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
                    <span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">validation_layout</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_components</span>
                <span class="p">)</span>

            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;validation_layout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_layout</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">ui</span><span class="p">:</span>
            <span class="c1"># Add custom dev tools hooks if the ui is activated.</span>
            <span class="n">custom_dev_tools</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hook_dev_tools</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;dev_tools&quot;</span><span class="p">):</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">hook_dev_tools</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;props&quot;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
                    <span class="n">props</span> <span class="o">=</span> <span class="n">props</span><span class="p">()</span>
                <span class="n">custom_dev_tools</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="o">**</span><span class="n">hook_dev_tools</span><span class="p">,</span> <span class="s2">&quot;props&quot;</span><span class="p">:</span> <span class="n">props</span><span class="p">})</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dev_tools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">custom_dev_tools</span>

        <span class="k">return</span> <span class="n">config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serve_reload_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_reload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hot_reload</span>
        <span class="k">with</span> <span class="n">_reload</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">hard</span> <span class="o">=</span> <span class="n">_reload</span><span class="o">.</span><span class="n">hard</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="n">_reload</span><span class="o">.</span><span class="n">changed_assets</span>
            <span class="n">_hash</span> <span class="o">=</span> <span class="n">_reload</span><span class="o">.</span><span class="n">hash</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">hard</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">changed_assets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">jsonify</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;reloadHash&quot;</span><span class="p">:</span> <span class="n">_hash</span><span class="p">,</span>
                <span class="s2">&quot;hard&quot;</span><span class="p">:</span> <span class="n">hard</span><span class="p">,</span>
                <span class="s2">&quot;packages&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_paths</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">changed</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libraries</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dist_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_js_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;_css_dist&quot;</span><span class="p">):</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">ComponentRegistry</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">dist_type</span><span class="p">,</span> <span class="n">libraries</span><span class="p">)</span>
            <span class="n">srcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_and_register_resources</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">srcs</span><span class="p">:</span>
                <span class="n">dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">dist_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">src</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dists</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_collect_and_register_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">include_async</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># now needs the app context.</span>
        <span class="c1"># template in the necessary component suite JS bundles</span>
        <span class="c1"># add the version number of the package as a query parameter</span>
        <span class="c1"># for cache busting</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_relative_url_path</span><span class="p">(</span><span class="n">relative_package_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">relative_package_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcc&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;dash_table&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">relative_package_path</span> <span class="o">=</span> <span class="n">relative_package_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;dash.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">relative_package_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">__version__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span><span class="o">.</span><span class="n">__version__</span>

            <span class="n">module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  <span class="c1"># type: ignore[reportCallIssue]</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="vm">__file__</span><span class="p">),</span>  <span class="c1"># type: ignore[reportCallIssue]</span>
                <span class="n">relative_package_path</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">modified</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>

            <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">build_fingerprint</span><span class="p">(</span><span class="n">relative_package_path</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">modified</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requests_pathname_prefix</span><span class="si">}</span><span class="s2">_dash-component-suites/</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fingerprint</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">srcs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="n">is_dynamic_resource</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">is_async</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;async&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">excluded</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">include_async</span> <span class="ow">and</span> <span class="n">is_async</span>

            <span class="k">if</span> <span class="s2">&quot;relative_package_path&quot;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;relative_package_path&quot;</span><span class="p">]</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">paths</span>

                <span class="k">for</span> <span class="n">rel_path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">rel_path</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcc&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;dash_table&quot;</span><span class="p">]):</span>
                        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;dash.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">registered_paths</span><span class="p">[</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dynamic_resource</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">excluded</span><span class="p">:</span>
                        <span class="n">srcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">_relative_url_path</span><span class="p">(</span>
                                <span class="n">relative_package_path</span><span class="o">=</span><span class="n">rel_path</span><span class="p">,</span>
                                <span class="n">namespace</span><span class="o">=</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;external_url&quot;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dynamic_resource</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">excluded</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;external_url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">srcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;external_url&quot;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">srcs</span> <span class="o">+=</span> <span class="n">resource</span><span class="p">[</span><span class="s2">&quot;external_url&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;absolute_path&quot;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Serving files from absolute_path isn&#39;t supported yet&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;asset_path&quot;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                <span class="n">static_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_asset_url</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">&quot;asset_path&quot;</span><span class="p">])</span>
                <span class="c1"># Import .mjs files with type=module script tag</span>
                <span class="k">if</span> <span class="n">static_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mjs&quot;</span><span class="p">):</span>
                    <span class="n">srcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="n">static_url</span>
                            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;?m=</span><span class="si">{</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Add a cache-busting query param</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;module&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">srcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">static_url</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;?m=</span><span class="si">{</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>  <span class="c1"># Add a cache-busting query param</span>

        <span class="k">return</span> <span class="n">srcs</span>

    <span class="c1"># pylint: disable=protected-access</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_css_dist_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">external_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">external_stylesheets</span>
        <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_and_register_resources</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="o">.</span><span class="n">get_all_css</span><span class="p">()</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">_css_dist</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">format_tag</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">opened</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="si">{</span><span class="n">link</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="p">(</span><span class="n">external_links</span> <span class="o">+</span> <span class="n">links</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_scripts_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Dash renderer has dependencies like React which need to be rendered</span>
        <span class="c1"># before every other script. However, the dash renderer bundle</span>
        <span class="c1"># itself needs to be rendered after all of the component&#39;s</span>
        <span class="c1"># scripts have rendered.</span>
        <span class="c1"># The rest of the scripts can just be loaded after React but before</span>
        <span class="c1"># dash renderer.</span>
        <span class="c1"># pylint: disable=protected-access</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;dev&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="p">[</span><span class="s2">&quot;props_check&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="s2">&quot;prod&quot;</span>

        <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">js_dist_dependency</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">js_dist_dependency</span> <span class="ow">in</span> <span class="n">_dash_renderer</span><span class="o">.</span><span class="n">_js_dist_dependencies</span>
        <span class="p">]</span>
        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span><span class="o">.</span><span class="n">serve_dev_bundles</span>
        <span class="n">srcs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collect_and_register_resources</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span><span class="p">)</span>  <span class="c1"># type: ignore[reportArgumentType]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">external_scripts</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_and_register_resources</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">get_all_scripts</span><span class="p">(</span><span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span><span class="p">)</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span>
                    <span class="n">_dash_renderer</span><span class="o">.</span><span class="n">_js_dist</span><span class="p">,</span> <span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span>
                    <span class="n">dcc</span><span class="o">.</span><span class="n">_js_dist</span><span class="p">,</span> <span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">_js_dist</span><span class="p">,</span> <span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span>
                    <span class="n">dash_table</span><span class="o">.</span><span class="n">_js_dist</span><span class="p">,</span> <span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_filter_resources</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">_js_dist</span><span class="p">,</span> <span class="n">dev_bundles</span><span class="o">=</span><span class="n">dev</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_INLINE_SCRIPTS</span><span class="p">)</span>
        <span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_INLINE_SCRIPTS</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">format_tag</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
                <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;&lt;script src=&quot;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;/script&gt;&#39;</span>
                <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">srcs</span>
            <span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;script&gt;</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">&lt;/script&gt;&quot;</span> <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_config_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;script id=&quot;_dash-config&quot; type=&quot;application/json&quot;&gt;</span><span class="si">{</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">())</span><span class="si">}</span><span class="s1">&lt;/script&gt;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;script id=&quot;_dash-renderer&quot; type=&quot;application/javascript&quot;&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">renderer</span><span class="si">}</span><span class="s1">&lt;/script&gt;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">meta_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">has_ie_compat</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http-equiv&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;X-UA-Compatible&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta_tags</span>
        <span class="p">)</span>
        <span class="n">has_charset</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;charset&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta_tags</span><span class="p">)</span>
        <span class="n">has_viewport</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;viewport&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta_tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_ie_compat</span><span class="p">:</span>
            <span class="n">meta_tags</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;http-equiv&quot;</span><span class="p">:</span> <span class="s2">&quot;X-UA-Compatible&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;IE=edge&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_charset</span><span class="p">:</span>
            <span class="n">meta_tags</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;charset&quot;</span><span class="p">:</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_viewport</span><span class="p">:</span>
            <span class="n">meta_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;viewport&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">meta_tags</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta_tags</span>

    <span class="c1"># Serve the JS bundles for each package</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">serve_component_suites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">fingerprinted_path</span><span class="p">):</span>
        <span class="n">path_in_pkg</span><span class="p">,</span> <span class="n">has_fingerprint</span> <span class="o">=</span> <span class="n">check_fingerprint</span><span class="p">(</span><span class="n">fingerprinted_path</span><span class="p">)</span>

        <span class="n">_validate</span><span class="o">.</span><span class="n">validate_js_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_paths</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="n">path_in_pkg</span><span class="p">)</span>

        <span class="n">extension</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">path_in_pkg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mimetype</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">types_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">extension</span><span class="p">,</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">)</span>

        <span class="n">package</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;serving -- package: </span><span class="si">%s</span><span class="s2">[</span><span class="si">%s</span><span class="s2">] resource: </span><span class="si">%s</span><span class="s2"> =&gt; location: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">package_name</span><span class="p">,</span>
            <span class="n">package</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
            <span class="n">path_in_pkg</span><span class="p">,</span>
            <span class="n">package</span><span class="o">.</span><span class="n">__path__</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
            <span class="n">pkgutil</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">path_in_pkg</span><span class="p">),</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">mimetype</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">has_fingerprint</span><span class="p">:</span>
            <span class="c1"># Fingerprinted resources are good forever (1 year)</span>
            <span class="c1"># No need for ETag as the fingerprint changes with each build</span>
            <span class="n">response</span><span class="o">.</span><span class="n">cache_control</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="mi">31536000</span>  <span class="c1"># 1 year</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Non-fingerprinted resources are given an ETag that</span>
            <span class="c1"># will be used / check on future requests</span>
            <span class="n">response</span><span class="o">.</span><span class="n">add_etag</span><span class="p">()</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get_etag</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">request_etag</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;If-None-Match&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="o">==</span> <span class="n">request_etag</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">304</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="n">scripts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_scripts_html</span><span class="p">()</span>
        <span class="n">css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_css_dist_html</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_config_html</span><span class="p">()</span>
        <span class="n">metas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_meta</span><span class="p">()</span>
        <span class="n">renderer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_renderer</span><span class="p">()</span>

        <span class="c1"># use self.title instead of app.config.title for backwards compatibility</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_pages</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include_pages_meta</span><span class="p">:</span>
            <span class="n">metas</span> <span class="o">=</span> <span class="n">_page_meta_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">metas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_favicon</span><span class="p">:</span>
            <span class="n">favicon_mod_time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_favicon</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">favicon_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_asset_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_favicon</span><span class="p">)</span><span class="si">}</span><span class="s2">?m=</span><span class="si">{</span><span class="n">favicon_mod_time</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requests_pathname_prefix</span>
            <span class="n">favicon_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_favicon.ico?v=</span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">favicon</span> <span class="o">=</span> <span class="n">format_tag</span><span class="p">(</span>
            <span class="s2">&quot;link&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;rel&quot;</span><span class="p">:</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image/x-icon&quot;</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">:</span> <span class="n">favicon_url</span><span class="p">},</span>
            <span class="n">opened</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">      &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">format_tag</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">opened</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sanitize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metas</span>
        <span class="p">)</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_index</span><span class="p">(</span>
            <span class="n">metas</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">scripts</span><span class="o">=</span><span class="n">scripts</span><span class="p">,</span>
            <span class="n">app_entry</span><span class="o">=</span><span class="n">_app_entry</span><span class="p">,</span>
            <span class="n">favicon</span><span class="o">=</span><span class="n">favicon</span><span class="p">,</span>
            <span class="n">renderer</span><span class="o">=</span><span class="n">renderer</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="n">checks</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">_re_index_entry_id</span><span class="p">,</span>
            <span class="n">_re_index_config_id</span><span class="p">,</span>
            <span class="n">_re_index_scripts_id</span><span class="p">,</span>
            <span class="n">_re_renderer_scripts_id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_validate</span><span class="o">.</span><span class="n">validate_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">checks</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">interpolate_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metas</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">css</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">scripts</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">app_entry</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">favicon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">renderer</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called to create the initial HTML string that is loaded on page.</span>
<span class="sd">        Override this method to provide you own custom HTML.</span>

<span class="sd">        :Example:</span>

<span class="sd">            class MyDash(dash.Dash):</span>
<span class="sd">                def interpolate_index(self, **kwargs):</span>
<span class="sd">                    return &#39;&#39;&#39;&lt;!DOCTYPE html&gt;</span>
<span class="sd">                    &lt;html&gt;</span>
<span class="sd">                        &lt;head&gt;</span>
<span class="sd">                            &lt;title&gt;My App&lt;/title&gt;</span>
<span class="sd">                        &lt;/head&gt;</span>
<span class="sd">                        &lt;body&gt;</span>
<span class="sd">                            &lt;div id=&quot;custom-header&quot;&gt;My custom header&lt;/div&gt;</span>
<span class="sd">                            {app_entry}</span>
<span class="sd">                            {config}</span>
<span class="sd">                            {scripts}</span>
<span class="sd">                            {renderer}</span>
<span class="sd">                            &lt;div id=&quot;custom-footer&quot;&gt;My custom footer&lt;/div&gt;</span>
<span class="sd">                        &lt;/body&gt;</span>
<span class="sd">                    &lt;/html&gt;&#39;&#39;&#39;.format(app_entry=kwargs.get(&#39;app_entry&#39;),</span>
<span class="sd">                                      config=kwargs.get(&#39;config&#39;),</span>
<span class="sd">                                      scripts=kwargs.get(&#39;scripts&#39;),</span>
<span class="sd">                                      renderer=kwargs.get(&#39;renderer&#39;))</span>

<span class="sd">        :param metas: Collected &amp; formatted meta tags.</span>
<span class="sd">        :param title: The title of the app.</span>
<span class="sd">        :param css: Collected &amp; formatted css dependencies as &lt;link&gt; tags.</span>
<span class="sd">        :param config: Configs needed by dash-renderer.</span>
<span class="sd">        :param scripts: Collected &amp; formatted scripts tags.</span>
<span class="sd">        :param renderer: A script tag that instantiates the DashRenderer.</span>
<span class="sd">        :param app_entry: Where the app will render.</span>
<span class="sd">        :param favicon: A favicon &lt;link&gt; tag if found in assets folder.</span>
<span class="sd">        :return: The interpolated HTML string for the index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">interpolate_str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_string</span><span class="p">,</span>
            <span class="n">metas</span><span class="o">=</span><span class="n">metas</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">css</span><span class="o">=</span><span class="n">css</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">scripts</span><span class="o">=</span><span class="n">scripts</span><span class="p">,</span>
            <span class="n">favicon</span><span class="o">=</span><span class="n">favicon</span><span class="p">,</span>
            <span class="n">renderer</span><span class="o">=</span><span class="n">renderer</span><span class="p">,</span>
            <span class="n">app_entry</span><span class="o">=</span><span class="n">app_entry</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
            <span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback_list</span><span class="p">),</span>
            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clientside_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clientside_function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a callback that updates the output by calling a clientside</span>
<span class="sd">        (JavaScript) function instead of a Python function.</span>

<span class="sd">        Unlike `@app.callback`, `clientside_callback` is not a decorator:</span>
<span class="sd">        it takes either a</span>
<span class="sd">        `dash.dependencies.ClientsideFunction(namespace, function_name)`</span>
<span class="sd">        argument that describes which JavaScript function to call</span>
<span class="sd">        (Dash will look for the JavaScript function at</span>
<span class="sd">        `window.dash_clientside[namespace][function_name]`), or it may take</span>
<span class="sd">        a string argument that contains the clientside function source.</span>

<span class="sd">        For example, when using a `dash.dependencies.ClientsideFunction`:</span>
<span class="sd">        ```</span>
<span class="sd">        app.clientside_callback(</span>
<span class="sd">            ClientsideFunction(&#39;my_clientside_library&#39;, &#39;my_function&#39;),</span>
<span class="sd">            Output(&#39;my-div&#39; &#39;children&#39;),</span>
<span class="sd">            [Input(&#39;my-input&#39;, &#39;value&#39;),</span>
<span class="sd">             Input(&#39;another-input&#39;, &#39;value&#39;)]</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        With this signature, Dash&#39;s front-end will call</span>
<span class="sd">        `window.dash_clientside.my_clientside_library.my_function` with the</span>
<span class="sd">        current values of the `value` properties of the components `my-input`</span>
<span class="sd">        and `another-input` whenever those values change.</span>

<span class="sd">        Include a JavaScript file by including it your `assets/` folder. The</span>
<span class="sd">        file can be named anything but you&#39;ll need to assign the function&#39;s</span>
<span class="sd">        namespace to the `window.dash_clientside` namespace. For example,</span>
<span class="sd">        this file might look:</span>
<span class="sd">        ```</span>
<span class="sd">        window.dash_clientside = window.dash_clientside || {};</span>
<span class="sd">        window.dash_clientside.my_clientside_library = {</span>
<span class="sd">            my_function: function(input_value_1, input_value_2) {</span>
<span class="sd">                return (</span>
<span class="sd">                    parseFloat(input_value_1, 10) +</span>
<span class="sd">                    parseFloat(input_value_2, 10)</span>
<span class="sd">                );</span>
<span class="sd">            }</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>

<span class="sd">        Alternatively, you can pass the JavaScript source directly to</span>
<span class="sd">        `clientside_callback`. In this case, the same example would look like:</span>
<span class="sd">        ```</span>
<span class="sd">        app.clientside_callback(</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">            function(input_value_1, input_value_2) {</span>
<span class="sd">                return (</span>
<span class="sd">                    parseFloat(input_value_1, 10) +</span>
<span class="sd">                    parseFloat(input_value_2, 10)</span>
<span class="sd">                );</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;,</span>
<span class="sd">            Output(&#39;my-div&#39; &#39;children&#39;),</span>
<span class="sd">            [Input(&#39;my-input&#39;, &#39;value&#39;),</span>
<span class="sd">             Input(&#39;another-input&#39;, &#39;value&#39;)]</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        The last, optional argument `prevent_initial_call` causes the callback</span>
<span class="sd">        not to fire when its outputs are first added to the page. Defaults to</span>
<span class="sd">        `False` unless `prevent_initial_callbacks=True` at the app level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_callback</span><span class="o">.</span><span class="n">register_clientside_callback</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_callback_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">prevent_initial_callbacks</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span><span class="p">,</span>
            <span class="n">clientside_function</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normally used as a decorator, `@app.callback` provides a server-side</span>
<span class="sd">        callback relating the values of one or more `Output` items to one or</span>
<span class="sd">        more `Input` items which will trigger the callback when they change,</span>
<span class="sd">        and optionally `State` items which provide additional information but</span>
<span class="sd">        do not trigger the callback directly.</span>

<span class="sd">        The last, optional argument `prevent_initial_call` causes the callback</span>
<span class="sd">        not to fire when its outputs are first added to the page. Defaults to</span>
<span class="sd">        `False` unless `prevent_initial_callbacks=True` at the app level.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_callback</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
            <span class="o">*</span><span class="n">_args</span><span class="p">,</span>
            <span class="n">config_prevent_initial_callbacks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">prevent_initial_callbacks</span><span class="p">,</span>
            <span class="n">callback_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback_list</span><span class="p">,</span>
            <span class="n">callback_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">,</span>
            <span class="o">**</span><span class="n">_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># pylint: disable=R0915</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the global context for the request.&quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">({})</span>
        <span class="n">g</span><span class="o">.</span><span class="n">inputs_list</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">states_list</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">outputs_list</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">g</span><span class="o">.</span><span class="n">input_values</span> <span class="o">=</span> <span class="n">inputs_to_dict</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">inputs_list</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">state_values</span> <span class="o">=</span> <span class="n">inputs_to_dict</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">states_list</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">triggered_inputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;prop_id&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">input_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changedPropIds&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">]</span>
        <span class="n">g</span><span class="o">.</span><span class="n">dash_response</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">full_path</span>
        <span class="n">g</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="n">g</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">origin</span>
        <span class="n">g</span><span class="o">.</span><span class="n">updated_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">g</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare callback-related data.&quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">[</span><span class="n">output</span><span class="p">]</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">cb</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">background_callback_manager</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manager&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_background_manager</span>
            <span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">ignore_register_page</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Add args_grouping</span>
            <span class="n">inputs_state_indices</span> <span class="o">=</span> <span class="n">cb</span><span class="p">[</span><span class="s2">&quot;inputs_state_indices&quot;</span><span class="p">]</span>
            <span class="n">inputs_state</span> <span class="o">=</span> <span class="n">convert_to_AttributeDict</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">inputs_list</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">states_list</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;no_output&quot;</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">outputs_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">outputs_list</span><span class="p">:</span>
                <span class="c1"># Legacy support for older renderers</span>
                <span class="n">split_callback_id</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

            <span class="c1"># Update args_grouping attributes</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">inputs_state</span><span class="p">:</span>
                <span class="c1"># check for pattern matching: list of inputs or state</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">pattern_match_g</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">update_args_group</span><span class="p">(</span>
                            <span class="n">pattern_match_g</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changedPropIds&quot;</span><span class="p">,</span> <span class="p">[])</span>
                        <span class="p">)</span>
                <span class="n">update_args_group</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changedPropIds&quot;</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="n">g</span><span class="o">.</span><span class="n">args_grouping</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">using_args_grouping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_grouping</span><span class="p">(</span>
                <span class="n">inputs_state</span><span class="p">,</span> <span class="n">inputs_state_indices</span>
            <span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">outputs_grouping</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">using_outputs_grouping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_grouping</span><span class="p">(</span>
                <span class="n">g</span><span class="o">.</span><span class="n">outputs_list</span><span class="p">,</span> <span class="n">cb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputs_indices&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Callback function not found for output &#39;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_grouping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare grouping logic for inputs or outputs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">flat_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_list</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flat_data</span> <span class="o">=</span> <span class="n">data_list</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flat_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grouping</span> <span class="o">=</span> <span class="n">map_grouping</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ind</span><span class="p">:</span> <span class="n">flat_data</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">indices</span><span class="p">)</span>
            <span class="n">using_grouping</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">indices</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">grouping_len</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grouping</span><span class="p">,</span> <span class="n">using_grouping</span> <span class="o">=</span> <span class="p">[],</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">grouping</span><span class="p">,</span> <span class="n">using_grouping</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">outputs_list</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the callback with the prepared arguments.&quot;&quot;&quot;</span>
        <span class="n">g</span><span class="o">.</span><span class="n">cookies</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">full_path</span>
        <span class="n">g</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="n">g</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">origin</span>
        <span class="n">g</span><span class="o">.</span><span class="n">custom_data</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">({})</span>

        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">get_hooks</span><span class="p">(</span><span class="s2">&quot;custom_data&quot;</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">custom_data</span><span class="p">[</span><span class="n">hook</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c1"># noinspection PyArgumentList</span>
        <span class="n">partial_func</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="n">outputs_list</span><span class="o">=</span><span class="n">outputs_list</span><span class="p">,</span>
            <span class="n">background_callback_manager</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">background_callback_manager</span><span class="p">,</span>
            <span class="n">callback_context</span><span class="o">=</span><span class="n">g</span><span class="p">,</span>
            <span class="n">app</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">app_on_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_error</span><span class="p">,</span>
            <span class="n">app_use_async</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_async</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">partial_func</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_context</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_callback</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">inputs_to_vals</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">inputs_list</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">states_list</span><span class="p">)</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">copy_context</span><span class="p">()</span>
        <span class="n">partial_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_callback</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">outputs_list</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">partial_func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">partial_func</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">response_data</span><span class="p">):</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response_data</span>

        <span class="n">g</span><span class="o">.</span><span class="n">dash_response</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">dash_response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_context</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_callback</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">inputs_to_vals</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">inputs_list</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">states_list</span><span class="p">)</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">copy_context</span><span class="p">()</span>
        <span class="n">partial_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_callback</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">outputs_list</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">partial_func</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">response_data</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;You are trying to use a coroutine without dash[async]. &quot;</span>
                <span class="s2">&quot;Please install the dependencies via `pip install dash[async]` and ensure &quot;</span>
                <span class="s2">&quot;that `use_async=False` is not being passed to the app.&quot;</span>
            <span class="p">)</span>

        <span class="n">g</span><span class="o">.</span><span class="n">dash_response</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">dash_response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">[</span><span class="s2">&quot;setup_server&quot;</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">[</span><span class="s2">&quot;setup_server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Apply _force_eager_loading overrides from modules</span>
        <span class="n">eager_loading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">eager_loading</span>
        <span class="k">for</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">ComponentRegistry</span><span class="o">.</span><span class="n">registry</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>
            <span class="n">eager</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;_force_eager_loading&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">eager_loading</span> <span class="o">=</span> <span class="n">eager_loading</span> <span class="ow">or</span> <span class="n">eager</span>

        <span class="c1"># Update eager_loading settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">eager_loading</span> <span class="o">=</span> <span class="n">eager_loading</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">include_assets_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_walk_assets_directory</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_pages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">page_container</span>

        <span class="n">_validate</span><span class="o">.</span><span class="n">validate_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout_value</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_scripts_html</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_css_dist_html</span><span class="p">()</span>

        <span class="c1"># Copy over global callback data structures assigned with `dash.callback`</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_CALLBACK_MAP</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DuplicateCallback</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The callback `</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">` provided with `dash.callback` was already &quot;</span>
                    <span class="s2">&quot;assigned with `app.callback`.&quot;</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_CALLBACK_MAP</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_callback_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_CALLBACK_LIST</span><span class="p">)</span>
        <span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_CALLBACK_LIST</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">_validate</span><span class="o">.</span><span class="n">validate_background_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="p">)</span>

        <span class="n">cancels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">callback</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">background</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;cancel_inputs&quot;</span> <span class="ow">in</span> <span class="n">background</span><span class="p">:</span>
                <span class="n">cancel</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cancel_inputs&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cancel</span><span class="p">:</span>
                    <span class="n">cancels</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manager&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cancels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cancel_input</span><span class="p">,</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">cancels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># pylint: disable=cell-var-from-loop</span>
                <span class="nd">@self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
                    <span class="n">Output</span><span class="p">(</span><span class="n">cancel_input</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">),</span>
                    <span class="n">cancel_input</span><span class="p">,</span>
                    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">manager</span><span class="o">=</span><span class="n">manager</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">cancel_call</span><span class="p">(</span><span class="o">*</span><span class="n">_</span><span class="p">):</span>
                    <span class="n">job_ids</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;cancelJob&quot;</span><span class="p">)</span>
                    <span class="n">executor</span> <span class="o">=</span> <span class="n">_callback</span><span class="o">.</span><span class="n">context_value</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">background_callback_manager</span>
                    <span class="k">if</span> <span class="n">job_ids</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">job_ids</span><span class="p">:</span>
                            <span class="n">executor</span><span class="o">.</span><span class="n">terminate_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">no_update</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_assets_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;asset_path&quot;</span><span class="p">:</span> <span class="n">url_path</span><span class="p">,</span> <span class="s2">&quot;filepath&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_external_path</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">&quot;external_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_asset_url</span><span class="p">(</span><span class="n">url_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assets_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_walk_assets_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">walk_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_folder</span>
        <span class="n">slash_splitter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[</span><span class="se">\\</span><span class="s2">/]+&quot;</span><span class="p">)</span>
        <span class="n">ignore_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_ignore</span>
        <span class="n">ignore_path_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_path_ignore</span>
        <span class="n">ignore_filter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ignore_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">ignore_str</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">ignore_path_filters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">ignore_path</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ignore_path</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ignore_path_list</span> <span class="ow">or</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">ignore_path</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">current</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">walk_dir</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">walk_dir</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">walk_dir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="n">splitted</span> <span class="o">=</span> <span class="n">slash_splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slash_splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="n">splitted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Check if any level of current path matches ignore path</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">ignore_path_filter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ignore_path_filter</span> <span class="ow">in</span> <span class="n">ignore_path_filters</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ignore_filter</span><span class="p">:</span>
                    <span class="n">files_gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_filter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">files_gen</span> <span class="o">=</span> <span class="n">files</span>

                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files_gen</span><span class="p">):</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base</span><span class="p">,</span> <span class="n">f</span><span class="p">])</span> <span class="k">if</span> <span class="n">base</span> <span class="k">else</span> <span class="n">f</span>

                    <span class="n">full</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;js&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">append_script</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_add_assets_resource</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">full</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;css&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="o">.</span><span class="n">append_css</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_assets_resource</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">full</span><span class="p">))</span>  <span class="c1"># type: ignore[reportArgumentType]</span>
                    <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s2">&quot;favicon.ico&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_favicon</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_invalid_resources_handler</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">404</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_serve_default_favicon</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
            <span class="n">pkgutil</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="s2">&quot;favicon.ico&quot;</span><span class="p">),</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;image/x-icon&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">csp_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hash_algorithm</span><span class="o">=</span><span class="s2">&quot;sha256&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates CSP hashes (sha + base64) of all inline scripts, such that</span>
<span class="sd">        one of the biggest benefits of CSP (disallowing general inline scripts)</span>
<span class="sd">        can be utilized together with Dash clientside callbacks (inline scripts).</span>

<span class="sd">        Calculate these hashes after all inline callbacks are defined,</span>
<span class="sd">        and add them to your CSP headers before starting the server, for example</span>
<span class="sd">        with the flask-talisman package from PyPI:</span>

<span class="sd">        flask_talisman.Talisman(app.server, content_security_policy={</span>
<span class="sd">            &quot;default-src&quot;: &quot;&#39;self&#39;&quot;,</span>
<span class="sd">            &quot;script-src&quot;: [&quot;&#39;self&#39;&quot;] + app.csp_hashes()</span>
<span class="sd">        })</span>

<span class="sd">        :param hash_algorithm: One of the recognized CSP hash algorithms (&#39;sha256&#39;, &#39;sha384&#39;, &#39;sha512&#39;).</span>
<span class="sd">        :return: List of CSP hash strings of all inline scripts.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">HASH_ALGORITHMS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sha256&quot;</span><span class="p">,</span> <span class="s2">&quot;sha384&quot;</span><span class="p">,</span> <span class="s2">&quot;sha512&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hash_algorithm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HASH_ALGORITHMS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Possible CSP hash algorithms: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">HASH_ALGORITHMS</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">hashlib</span><span class="p">,</span> <span class="n">hash_algorithm</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_hash</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">method</span><span class="p">(</span><span class="n">script</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                <span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_INLINE_SCRIPTS</span><span class="p">)</span>
        <span class="n">_callback</span><span class="o">.</span><span class="n">GLOBAL_INLINE_SCRIPTS</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">hash_algorithm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">_hash</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inline_scripts</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">renderer</span><span class="p">])</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_asset_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the URL for the provided `path` in the assets directory.</span>

<span class="sd">        If `assets_external_path` is set, `get_asset_url` returns</span>
<span class="sd">        `assets_external_path` + `assets_url_path` + `path`, where</span>
<span class="sd">        `path` is the path passed to `get_asset_url`.</span>

<span class="sd">        Otherwise, `get_asset_url` returns</span>
<span class="sd">        `requests_pathname_prefix` + `assets_url_path` + `path`, where</span>
<span class="sd">        `path` is the path passed to `get_asset_url`.</span>

<span class="sd">        Use `get_asset_url` in an app to access assets at the correct location</span>
<span class="sd">        in different environments. In a deployed app on Dash Enterprise,</span>
<span class="sd">        `requests_pathname_prefix` is the app name. For an app called &quot;my-app&quot;,</span>
<span class="sd">        `app.get_asset_url(&quot;image.png&quot;)` would return:</span>

<span class="sd">        ```</span>
<span class="sd">        /my-app/assets/image.png</span>
<span class="sd">        ```</span>

<span class="sd">        While the same app running locally, without</span>
<span class="sd">        `requests_pathname_prefix` set, would return:</span>

<span class="sd">        ```</span>
<span class="sd">        /assets/image.png</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_get_paths</span><span class="o">.</span><span class="n">app_get_asset_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_relative_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a path with `requests_pathname_prefix` prefixed before it.</span>
<span class="sd">        Use this function when specifying local URL paths that will work</span>
<span class="sd">        in environments regardless of what `requests_pathname_prefix` is.</span>
<span class="sd">        In some deployment environments, like Dash Enterprise,</span>
<span class="sd">        `requests_pathname_prefix` is set to the application name,</span>
<span class="sd">        e.g. `my-dash-app`.</span>
<span class="sd">        When working locally, `requests_pathname_prefix` might be unset and</span>
<span class="sd">        so a relative URL like `/page-2` can just be `/page-2`.</span>
<span class="sd">        However, when the app is deployed to a URL like `/my-dash-app`, then</span>
<span class="sd">        `app.get_relative_path(&#39;/page-2&#39;)` will return `/my-dash-app/page-2`.</span>
<span class="sd">        This can be used as an alternative to `get_asset_url` as well with</span>
<span class="sd">        `app.get_relative_path(&#39;/assets/logo.png&#39;)`</span>

<span class="sd">        Use this function with `app.strip_relative_path` in callbacks that</span>
<span class="sd">        deal with `dcc.Location` `pathname` routing.</span>
<span class="sd">        That is, your usage may look like:</span>
<span class="sd">        ```</span>
<span class="sd">        app.layout = html.Div([</span>
<span class="sd">            dcc.Location(id=&#39;url&#39;),</span>
<span class="sd">            html.Div(id=&#39;content&#39;)</span>
<span class="sd">        ])</span>
<span class="sd">        @app.callback(Output(&#39;content&#39;, &#39;children&#39;), [Input(&#39;url&#39;, &#39;pathname&#39;)])</span>
<span class="sd">        def display_content(path):</span>
<span class="sd">            page_name = app.strip_relative_path(path)</span>
<span class="sd">            if not page_name:  # None or &#39;&#39;</span>
<span class="sd">                return html.Div([</span>
<span class="sd">                    dcc.Link(href=app.get_relative_path(&#39;/page-1&#39;)),</span>
<span class="sd">                    dcc.Link(href=app.get_relative_path(&#39;/page-2&#39;)),</span>
<span class="sd">                ])</span>
<span class="sd">            elif page_name == &#39;page-1&#39;:</span>
<span class="sd">                return chapters.page_1</span>
<span class="sd">            if page_name == &quot;page-2&quot;:</span>
<span class="sd">                return chapters.page_2</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_get_paths</span><span class="o">.</span><span class="n">app_get_relative_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requests_pathname_prefix</span><span class="p">,</span> <span class="n">path</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">strip_relative_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a path with `requests_pathname_prefix` and leading and trailing</span>
<span class="sd">        slashes stripped from it. Also, if None is passed in, None is returned.</span>
<span class="sd">        Use this function with `get_relative_path` in callbacks that deal</span>
<span class="sd">        with `dcc.Location` `pathname` routing.</span>
<span class="sd">        That is, your usage may look like:</span>
<span class="sd">        ```</span>
<span class="sd">        app.layout = html.Div([</span>
<span class="sd">            dcc.Location(id=&#39;url&#39;),</span>
<span class="sd">            html.Div(id=&#39;content&#39;)</span>
<span class="sd">        ])</span>
<span class="sd">        @app.callback(Output(&#39;content&#39;, &#39;children&#39;), [Input(&#39;url&#39;, &#39;pathname&#39;)])</span>
<span class="sd">        def display_content(path):</span>
<span class="sd">            page_name = app.strip_relative_path(path)</span>
<span class="sd">            if not page_name:  # None or &#39;&#39;</span>
<span class="sd">                return html.Div([</span>
<span class="sd">                    dcc.Link(href=app.get_relative_path(&#39;/page-1&#39;)),</span>
<span class="sd">                    dcc.Link(href=app.get_relative_path(&#39;/page-2&#39;)),</span>
<span class="sd">                ])</span>
<span class="sd">            elif page_name == &#39;page-1&#39;:</span>
<span class="sd">                return chapters.page_1</span>
<span class="sd">            if page_name == &quot;page-2&quot;:</span>
<span class="sd">                return chapters.page_2</span>
<span class="sd">        ```</span>
<span class="sd">        Note that `chapters.page_1` will be served if the user visits `/page-1`</span>
<span class="sd">        _or_ `/page-1/` since `strip_relative_path` removes the trailing slash.</span>

<span class="sd">        Also note that `strip_relative_path` is compatible with</span>
<span class="sd">        `get_relative_path` in environments where `requests_pathname_prefix` set.</span>
<span class="sd">        In some deployment environments, like Dash Enterprise,</span>
<span class="sd">        `requests_pathname_prefix` is set to the application name, e.g. `my-dash-app`.</span>
<span class="sd">        When working locally, `requests_pathname_prefix` might be unset and</span>
<span class="sd">        so a relative URL like `/page-2` can just be `/page-2`.</span>
<span class="sd">        However, when the app is deployed to a URL like `/my-dash-app`, then</span>
<span class="sd">        `app.get_relative_path(&#39;/page-2&#39;)` will return `/my-dash-app/page-2`</span>

<span class="sd">        The `pathname` property of `dcc.Location` will return &#39;`/my-dash-app/page-2`&#39;</span>
<span class="sd">        to the callback.</span>
<span class="sd">        In this case, `app.strip_relative_path(&#39;/my-dash-app/page-2&#39;)`</span>
<span class="sd">        will return `&#39;page-2&#39;`</span>

<span class="sd">        For nested URLs, slashes are still included:</span>
<span class="sd">        `app.strip_relative_path(&#39;/page-1/sub-page-1/&#39;)` will return</span>
<span class="sd">        `page-1/sub-page-1`</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_get_paths</span><span class="o">.</span><span class="n">app_strip_relative_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requests_pathname_prefix</span><span class="p">,</span> <span class="n">path</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_startup_route</span><span class="p">(</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">view_func</span><span class="p">:</span> <span class="n">RouteCallable</span><span class="p">,</span> <span class="n">methods</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a route to the app to be initialized at the end of Dash initialization.</span>
<span class="sd">        Use this if the package requires a route to be added to the app, and you will not need to worry about at what point to add it.</span>

<span class="sd">        :param name: The name of the route. eg &quot;my-new-url/path&quot;.</span>
<span class="sd">        :param view_func: The function to call when the route is requested. The function should return a JSON serializable object.</span>
<span class="sd">        :param methods: The HTTP methods that the route should respond to. eg [&quot;GET&quot;, &quot;POST&quot;] or either one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;name must be a string and should not start with &#39;/&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">view_func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;view_func must be callable&quot;</span><span class="p">)</span>

        <span class="n">valid_methods</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">valid_methods</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;methods should only contain </span><span class="si">{</span><span class="n">valid_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span> <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">Dash</span><span class="o">.</span><span class="n">STARTUP_ROUTES</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Route name &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is already in use.&quot;</span><span class="p">)</span>

        <span class="n">Dash</span><span class="o">.</span><span class="n">STARTUP_ROUTES</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">view_func</span><span class="p">,</span> <span class="n">methods</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_startup_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the startup routes stored in STARTUP_ROUTES.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_view_func</span><span class="p">,</span> <span class="n">_methods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STARTUP_ROUTES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_dash_startup_route/</span><span class="si">{</span><span class="n">_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_view_func</span><span class="p">,</span> <span class="n">_methods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STARTUP_ROUTES</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_dev_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">dev_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dev_tools</span> <span class="o">=</span> <span class="n">AttributeDict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;ui&quot;</span><span class="p">,</span>
            <span class="s2">&quot;props_check&quot;</span><span class="p">,</span>
            <span class="s2">&quot;serve_dev_bundles&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hot_reload&quot;</span><span class="p">,</span>
            <span class="s2">&quot;silence_routes_logging&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prune_errors&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">dev_tools</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_combined_config</span><span class="p">(</span>
                <span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">debug</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">_type</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;hot_reload_interval&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;hot_reload_watch_interval&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;hot_reload_max_retry&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">dev_tools</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">_type</span><span class="p">(</span>
                <span class="n">get_combined_config</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">dev_tools</span><span class="p">[</span><span class="s2">&quot;disable_version_check&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_combined_config</span><span class="p">(</span>
            <span class="s2">&quot;disable_version_check&quot;</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disable_version_check&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">dev_tools</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enable_dev_tools</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_ui</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_props_check</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_serve_dev_bundles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload_watch_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload_max_retry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_silence_routes_logging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_disable_version_check</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_prune_errors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the dev tools, called by `run`. If your application</span>
<span class="sd">        is served by wsgi and you want to activate the dev tools, you can call</span>
<span class="sd">        this method out of `__main__`.</span>

<span class="sd">        All parameters can be set by environment variables as listed.</span>
<span class="sd">        Values provided here take precedence over environment variables.</span>

<span class="sd">        Available dev_tools environment variables:</span>

<span class="sd">            - DASH_DEBUG</span>
<span class="sd">            - DASH_UI</span>
<span class="sd">            - DASH_PROPS_CHECK</span>
<span class="sd">            - DASH_SERVE_DEV_BUNDLES</span>
<span class="sd">            - DASH_HOT_RELOAD</span>
<span class="sd">            - DASH_HOT_RELOAD_INTERVAL</span>
<span class="sd">            - DASH_HOT_RELOAD_WATCH_INTERVAL</span>
<span class="sd">            - DASH_HOT_RELOAD_MAX_RETRY</span>
<span class="sd">            - DASH_SILENCE_ROUTES_LOGGING</span>
<span class="sd">            - DASH_DISABLE_VERSION_CHECK</span>
<span class="sd">            - DASH_PRUNE_ERRORS</span>

<span class="sd">        :param debug: Enable/disable all the dev tools unless overridden by the</span>
<span class="sd">            arguments or environment variables. Default is ``True`` when</span>
<span class="sd">            ``enable_dev_tools`` is called directly, and ``False`` when called</span>
<span class="sd">            via ``run``. env: ``DASH_DEBUG``</span>
<span class="sd">        :type debug: bool</span>

<span class="sd">        :param dev_tools_ui: Show the dev tools UI. env: ``DASH_UI``</span>
<span class="sd">        :type dev_tools_ui: bool</span>

<span class="sd">        :param dev_tools_props_check: Validate the types and values of Dash</span>
<span class="sd">            component props. env: ``DASH_PROPS_CHECK``</span>
<span class="sd">        :type dev_tools_props_check: bool</span>

<span class="sd">        :param dev_tools_serve_dev_bundles: Serve the dev bundles. Production</span>
<span class="sd">            bundles do not necessarily include all the dev tools code.</span>
<span class="sd">            env: ``DASH_SERVE_DEV_BUNDLES``</span>
<span class="sd">        :type dev_tools_serve_dev_bundles: bool</span>

<span class="sd">        :param dev_tools_hot_reload: Activate hot reloading when app, assets,</span>
<span class="sd">            and component files change. env: ``DASH_HOT_RELOAD``</span>
<span class="sd">        :type dev_tools_hot_reload: bool</span>

<span class="sd">        :param dev_tools_hot_reload_interval: Interval in seconds for the</span>
<span class="sd">            client to request the reload hash. Default 3.</span>
<span class="sd">            env: ``DASH_HOT_RELOAD_INTERVAL``</span>
<span class="sd">        :type dev_tools_hot_reload_interval: float</span>

<span class="sd">        :param dev_tools_hot_reload_watch_interval: Interval in seconds for the</span>
<span class="sd">            server to check asset and component folders for changes.</span>
<span class="sd">            Default 0.5. env: ``DASH_HOT_RELOAD_WATCH_INTERVAL``</span>
<span class="sd">        :type dev_tools_hot_reload_watch_interval: float</span>

<span class="sd">        :param dev_tools_hot_reload_max_retry: Maximum number of failed reload</span>
<span class="sd">            hash requests before failing and displaying a pop up. Default 8.</span>
<span class="sd">            env: ``DASH_HOT_RELOAD_MAX_RETRY``</span>
<span class="sd">        :type dev_tools_hot_reload_max_retry: int</span>

<span class="sd">        :param dev_tools_silence_routes_logging: Silence the `werkzeug` logger,</span>
<span class="sd">            will remove all routes logging. Enabled with debugging by default</span>
<span class="sd">            because hot reload hash checks generate a lot of requests.</span>
<span class="sd">            env: ``DASH_SILENCE_ROUTES_LOGGING``</span>
<span class="sd">        :type dev_tools_silence_routes_logging: bool</span>

<span class="sd">        :param dev_tools_disable_version_check: Silence the upgrade</span>
<span class="sd">            notification to prevent making requests to the Dash server.</span>
<span class="sd">            env: ``DASH_DISABLE_VERSION_CHECK``</span>
<span class="sd">        :type dev_tools_disable_version_check: bool</span>

<span class="sd">        :param dev_tools_prune_errors: Reduce tracebacks to just user code,</span>
<span class="sd">            stripping out Flask and Dash pieces. Only available with debugging.</span>
<span class="sd">            `True` by default, set to `False` to see the complete traceback.</span>
<span class="sd">            env: ``DASH_PRUNE_ERRORS``</span>
<span class="sd">        :type dev_tools_prune_errors: bool</span>

<span class="sd">        :return: debug</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">debug</span> <span class="o">=</span> <span class="n">get_combined_config</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">dev_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_dev_tools</span><span class="p">(</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="n">ui</span><span class="o">=</span><span class="n">dev_tools_ui</span><span class="p">,</span>
            <span class="n">props_check</span><span class="o">=</span><span class="n">dev_tools_props_check</span><span class="p">,</span>
            <span class="n">serve_dev_bundles</span><span class="o">=</span><span class="n">dev_tools_serve_dev_bundles</span><span class="p">,</span>
            <span class="n">hot_reload</span><span class="o">=</span><span class="n">dev_tools_hot_reload</span><span class="p">,</span>
            <span class="n">hot_reload_interval</span><span class="o">=</span><span class="n">dev_tools_hot_reload_interval</span><span class="p">,</span>
            <span class="n">hot_reload_watch_interval</span><span class="o">=</span><span class="n">dev_tools_hot_reload_watch_interval</span><span class="p">,</span>
            <span class="n">hot_reload_max_retry</span><span class="o">=</span><span class="n">dev_tools_hot_reload_max_retry</span><span class="p">,</span>
            <span class="n">silence_routes_logging</span><span class="o">=</span><span class="n">dev_tools_silence_routes_logging</span><span class="p">,</span>
            <span class="n">disable_version_check</span><span class="o">=</span><span class="n">dev_tools_disable_version_check</span><span class="p">,</span>
            <span class="n">prune_errors</span><span class="o">=</span><span class="n">dev_tools_prune_errors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">dev_tools</span><span class="o">.</span><span class="n">silence_routes_logging</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;werkzeug&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dev_tools</span><span class="o">.</span><span class="n">hot_reload</span><span class="p">:</span>
            <span class="n">_reload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hot_reload</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">hash</span> <span class="o">=</span> <span class="n">generate_hash</span><span class="p">()</span>

            <span class="c1"># find_loader should return None on __main__ but doesn&#39;t</span>
            <span class="c1"># on some Python versions https://bugs.python.org/issue14710</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">pkgutil</span><span class="o">.</span><span class="n">find_loader</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ComponentRegistry</span><span class="o">.</span><span class="n">registry</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;__main__&quot;</span>
            <span class="p">]</span>

            <span class="c1"># # additional condition to account for AssertionRewritingHook object</span>
            <span class="c1"># # loader when running pytest</span>

            <span class="k">if</span> <span class="s2">&quot;_pytest&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">_pytest.assertion.rewrite</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># pylint: disable=import-outside-toplevel</span>
                    <span class="n">AssertionRewritingHook</span><span class="p">,</span>  <span class="c1"># type: ignore[reportPrivateImportUsage]</span>
                <span class="p">)</span>

                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">package</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">packages</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">AssertionRewritingHook</span><span class="p">):</span>
                        <span class="n">dash_spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[reportAttributeAccess]</span>
                        <span class="n">dash_test_path</span> <span class="o">=</span> <span class="n">dash_spec</span><span class="o">.</span><span class="n">submodule_search_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">dash_spec</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="n">dash_test_path</span><span class="p">)</span>
                        <span class="n">packages</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dash_spec</span>

            <span class="n">component_packages_dist</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dash_test_path</span>  <span class="c1"># type: ignore[reportPossiblyUnboundVariable]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">ModuleSpec</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[reportAttributeAccessIssue]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
                    <span class="n">package</span><span class="o">.</span><span class="n">_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># type: ignore[reportAttributeAccessIssue]; pylint: disable=protected-access</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s2">&quot;_path&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">package</span><span class="o">.</span><span class="n">filename</span>  <span class="c1"># type: ignore[reportAttributeAccessIssue]</span>
                <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">package</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">packages</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;dash/dash&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
                    <span class="n">package</span><span class="o">.</span><span class="n">path</span>  <span class="c1"># type: ignore[reportAttributeAccessIssue]</span>
                <span class="p">):</span>
                    <span class="n">component_packages_dist</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># type: ignore[reportAttributeAccessIssue]</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcc&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;dash_table&quot;</span><span class="p">]</span>
                    <span class="p">]</span>

            <span class="n">_reload</span><span class="o">.</span><span class="n">watch_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_watch</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_folder</span><span class="p">]</span> <span class="o">+</span> <span class="n">component_packages_dist</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_assets_change</span><span class="p">,</span>
                    <span class="n">sleep_time</span><span class="o">=</span><span class="n">dev_tools</span><span class="o">.</span><span class="n">hot_reload_watch_interval</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">watch_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">watch_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">configure_callback_exception_handling</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">dev_tools</span><span class="o">.</span><span class="n">prune_errors</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">dev_tools</span><span class="o">.</span><span class="n">prune_errors</span><span class="p">:</span>
                <span class="n">secret</span> <span class="o">=</span> <span class="n">gen_salt</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

                <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_errors</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
                    <span class="c1"># find the callback invocation, if the error is from a callback</span>
                    <span class="c1"># and skip the traceback up to that point</span>
                    <span class="c1"># if the error didn&#39;t come from inside a callback, we won&#39;t</span>
                    <span class="c1"># skip anything.</span>
                    <span class="n">tb</span> <span class="o">=</span> <span class="n">_get_traceback</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">tb</span><span class="p">,</span> <span class="mi">500</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="n">dev_tools</span><span class="o">.</span><span class="n">ui</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_before_request</span><span class="p">():</span>
                <span class="n">flask</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">timing_information</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># pylint: disable=assigning-non-slot</span>
                    <span class="s2">&quot;__dash_server&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;dur&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
                <span class="p">}</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
                <span class="n">timing_information</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timing_information&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">timing_information</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">response</span>

                <span class="n">dash_total</span> <span class="o">=</span> <span class="n">timing_information</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__dash_server&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dash_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dash_total</span><span class="p">[</span><span class="s2">&quot;dur&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">dash_total</span><span class="p">[</span><span class="s2">&quot;dur&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">timing_information</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;desc&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;;desc=&quot;</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;desc&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

                    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dur&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;;dur=</span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Server-Timing&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">response</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">before_request</span><span class="p">(</span><span class="n">_before_request</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">after_request</span><span class="p">(</span><span class="n">_after_request</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">debug</span>
            <span class="ow">and</span> <span class="n">dev_tools</span><span class="o">.</span><span class="n">serve_dev_bundles</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">serve_locally</span>
        <span class="p">):</span>
            <span class="c1"># Dev bundles only works locally.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">serve_locally</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: dev bundles requested with serve_locally=False.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;This is not supported, switching to serve_locally=True&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">debug</span>

    <span class="c1"># noinspection PyProtectedMember</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_assets_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">modified</span><span class="p">,</span> <span class="n">deleted</span><span class="p">):</span>
        <span class="n">_reload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hot_reload</span>
        <span class="k">with</span> <span class="n">_reload</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">hard</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_reload</span><span class="o">.</span><span class="n">hash</span> <span class="o">=</span> <span class="n">generate_hash</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_folder</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">asset_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                        <span class="n">filename</span><span class="p">,</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">assets_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">_reload</span><span class="o">.</span><span class="n">changed_assets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_asset_url</span><span class="p">(</span><span class="n">asset_path</span><span class="p">),</span>
                        <span class="s2">&quot;modified&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">modified</span><span class="p">),</span>
                        <span class="s2">&quot;is_css&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;css&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assets_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">deleted</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_assets_resource</span><span class="p">(</span><span class="n">asset_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;js&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">append_script</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;css&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="o">.</span><span class="n">append_css</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># type: ignore[reportArgumentType]</span>

                <span class="k">if</span> <span class="n">deleted</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assets_files</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_assets_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

                    <span class="k">def</span><span class="w"> </span><span class="nf">delete_resource</span><span class="p">(</span><span class="n">resources</span><span class="p">):</span>
                        <span class="n">to_delete</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asset_path&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">asset_path</span><span class="p">:</span>
                                <span class="n">to_delete</span> <span class="o">=</span> <span class="n">r</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="n">to_delete</span><span class="p">:</span>
                            <span class="n">resources</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;js&quot;</span><span class="p">):</span>
                        <span class="c1"># pylint: disable=protected-access</span>
                        <span class="n">delete_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_resources</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;css&quot;</span><span class="p">):</span>
                        <span class="c1"># pylint: disable=protected-access</span>
                        <span class="n">delete_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="o">.</span><span class="n">_resources</span><span class="o">.</span><span class="n">_resources</span><span class="p">)</span>

    <span class="c1"># pylint: disable=too-many-branches</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">proxy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">jupyter_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JupyterDisplayMode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">jupyter_width</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
        <span class="n">jupyter_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span>
        <span class="n">jupyter_server_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_ui</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_props_check</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_serve_dev_bundles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload_watch_interval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_hot_reload_max_retry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_silence_routes_logging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_disable_version_check</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev_tools_prune_errors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">flask_run_options</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the flask server in local mode, you should not run this on a</span>
<span class="sd">        production server, use gunicorn/waitress instead.</span>

<span class="sd">        If a parameter can be set by an environment variable, that is listed</span>
<span class="sd">        too. Values provided here take precedence over environment variables.</span>

<span class="sd">        :param host: Host IP used to serve the application, default to &quot;127.0.0.1&quot;</span>
<span class="sd">            env: ``HOST``</span>
<span class="sd">        :type host: string</span>

<span class="sd">        :param port: Port used to serve the application, default to &quot;8050&quot;</span>
<span class="sd">            env: ``PORT``</span>
<span class="sd">        :type port: int</span>

<span class="sd">        :param proxy: If this application will be served to a different URL</span>
<span class="sd">            via a proxy configured outside of Python, you can list it here</span>
<span class="sd">            as a string of the form ``&quot;{input}::{output}&quot;``, for example:</span>
<span class="sd">            ``&quot;http://0.0.0.0:8050::https://my.domain.com&quot;``</span>
<span class="sd">            so that the startup message will display an accurate URL.</span>
<span class="sd">            env: ``DASH_PROXY``</span>
<span class="sd">        :type proxy: string</span>

<span class="sd">        :param debug: Set Flask debug mode and enable dev tools.</span>
<span class="sd">            env: ``DASH_DEBUG``</span>
<span class="sd">        :type debug: bool</span>

<span class="sd">        :param debug: Enable/disable all the dev tools unless overridden by the</span>
<span class="sd">            arguments or environment variables. Default is ``True`` when</span>
<span class="sd">            ``enable_dev_tools`` is called directly, and ``False`` when called</span>
<span class="sd">            via ``run``. env: ``DASH_DEBUG``</span>
<span class="sd">        :type debug: bool</span>

<span class="sd">        :param dev_tools_ui: Show the dev tools UI. env: ``DASH_UI``</span>
<span class="sd">        :type dev_tools_ui: bool</span>

<span class="sd">        :param dev_tools_props_check: Validate the types and values of Dash</span>
<span class="sd">            component props. env: ``DASH_PROPS_CHECK``</span>
<span class="sd">        :type dev_tools_props_check: bool</span>

<span class="sd">        :param dev_tools_serve_dev_bundles: Serve the dev bundles. Production</span>
<span class="sd">            bundles do not necessarily include all the dev tools code.</span>
<span class="sd">            env: ``DASH_SERVE_DEV_BUNDLES``</span>
<span class="sd">        :type dev_tools_serve_dev_bundles: bool</span>

<span class="sd">        :param dev_tools_hot_reload: Activate hot reloading when app, assets,</span>
<span class="sd">            and component files change. env: ``DASH_HOT_RELOAD``</span>
<span class="sd">        :type dev_tools_hot_reload: bool</span>

<span class="sd">        :param dev_tools_hot_reload_interval: Interval in seconds for the</span>
<span class="sd">            client to request the reload hash. Default 3.</span>
<span class="sd">            env: ``DASH_HOT_RELOAD_INTERVAL``</span>
<span class="sd">        :type dev_tools_hot_reload_interval: float</span>

<span class="sd">        :param dev_tools_hot_reload_watch_interval: Interval in seconds for the</span>
<span class="sd">            server to check asset and component folders for changes.</span>
<span class="sd">            Default 0.5. env: ``DASH_HOT_RELOAD_WATCH_INTERVAL``</span>
<span class="sd">        :type dev_tools_hot_reload_watch_interval: float</span>

<span class="sd">        :param dev_tools_hot_reload_max_retry: Maximum number of failed reload</span>
<span class="sd">            hash requests before failing and displaying a pop up. Default 8.</span>
<span class="sd">            env: ``DASH_HOT_RELOAD_MAX_RETRY``</span>
<span class="sd">        :type dev_tools_hot_reload_max_retry: int</span>

<span class="sd">        :param dev_tools_silence_routes_logging: Silence the `werkzeug` logger,</span>
<span class="sd">            will remove all routes logging. Enabled with debugging by default</span>
<span class="sd">            because hot reload hash checks generate a lot of requests.</span>
<span class="sd">            env: ``DASH_SILENCE_ROUTES_LOGGING``</span>
<span class="sd">        :type dev_tools_silence_routes_logging: bool</span>

<span class="sd">        :param dev_tools_disable_version_check: Silence the upgrade</span>
<span class="sd">            notification to prevent making requests to the Dash server.</span>
<span class="sd">            env: ``DASH_DISABLE_VERSION_CHECK``</span>
<span class="sd">        :type dev_tools_disable_version_check: bool</span>

<span class="sd">        :param dev_tools_prune_errors: Reduce tracebacks to just user code,</span>
<span class="sd">            stripping out Flask and Dash pieces. Only available with debugging.</span>
<span class="sd">            `True` by default, set to `False` to see the complete traceback.</span>
<span class="sd">            env: ``DASH_PRUNE_ERRORS``</span>
<span class="sd">        :type dev_tools_prune_errors: bool</span>

<span class="sd">        :param jupyter_mode: How to display the application when running</span>
<span class="sd">            inside a jupyter notebook.</span>

<span class="sd">        :param jupyter_width: Determine the width of the output cell</span>
<span class="sd">            when displaying inline in jupyter notebooks.</span>
<span class="sd">        :type jupyter_width: str</span>

<span class="sd">        :param jupyter_height: Height of app when displayed using</span>
<span class="sd">            jupyter_mode=&quot;inline&quot;</span>
<span class="sd">        :type jupyter_height: int</span>

<span class="sd">        :param jupyter_server_url: Custom server url to display</span>
<span class="sd">            the app in jupyter notebook.</span>

<span class="sd">        :param flask_run_options: Given to `Flask.run`</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">debug</span> <span class="o">=</span> <span class="n">get_combined_config</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_dev_tools</span><span class="p">(</span>
            <span class="n">debug</span><span class="p">,</span>
            <span class="n">dev_tools_ui</span><span class="p">,</span>
            <span class="n">dev_tools_props_check</span><span class="p">,</span>
            <span class="n">dev_tools_serve_dev_bundles</span><span class="p">,</span>
            <span class="n">dev_tools_hot_reload</span><span class="p">,</span>
            <span class="n">dev_tools_hot_reload_interval</span><span class="p">,</span>
            <span class="n">dev_tools_hot_reload_watch_interval</span><span class="p">,</span>
            <span class="n">dev_tools_hot_reload_max_retry</span><span class="p">,</span>
            <span class="n">dev_tools_silence_routes_logging</span><span class="p">,</span>
            <span class="n">dev_tools_disable_version_check</span><span class="p">,</span>
            <span class="n">dev_tools_prune_errors</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Evaluate the env variables at runtime</span>

        <span class="k">if</span> <span class="s2">&quot;CONDA_PREFIX&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="c1"># Some conda systems has issue with setting the host environment</span>
            <span class="c1"># to an invalid hostname.</span>
            <span class="c1"># Related issue: https://github.com/plotly/dash/issues/3069</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="ow">or</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">port</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;8050&quot;</span><span class="p">)</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DASH_PROXY&quot;</span><span class="p">)</span>

        <span class="c1"># Verify port value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">port</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">65536</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expecting an integer from 1 to 65535, found port=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,)</span>
            <span class="k">raise</span>

        <span class="c1"># so we only see the &quot;Running on&quot; message once with hot reloading</span>
        <span class="c1"># https://stackoverflow.com/a/57231282/9188800</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;WERKZEUG_RUN_MAIN&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">ssl_context</span> <span class="o">=</span> <span class="n">flask_run_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ssl_context&quot;</span><span class="p">)</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="s2">&quot;https&quot;</span> <span class="k">if</span> <span class="n">ssl_context</span> <span class="k">else</span> <span class="s2">&quot;http&quot;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">requests_pathname_prefix</span>

            <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
                <span class="n">served_url</span><span class="p">,</span> <span class="n">proxied_url</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">urlparse</span><span class="p">,</span> <span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">))</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">verify_url_part</span><span class="p">(</span><span class="n">served_part</span><span class="p">,</span> <span class="n">url_part</span><span class="p">,</span> <span class="n">part_name</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">served_part</span> <span class="o">!=</span> <span class="n">url_part</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ProxyError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                            </span><span class="si">{</span><span class="n">part_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">url_part</span><span class="si">}</span><span class="s2"> is incompatible with the proxy:</span>
<span class="s2">                                </span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span>
<span class="s2">                            To see your app at </span><span class="si">{</span><span class="n">proxied_url</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">                            you must use </span><span class="si">{</span><span class="n">part_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">served_part</span><span class="si">}</span>
<span class="s2">                            &quot;&quot;&quot;</span>
                        <span class="p">)</span>

                <span class="n">verify_url_part</span><span class="p">(</span><span class="n">served_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="s2">&quot;protocol&quot;</span><span class="p">)</span>
                <span class="n">verify_url_part</span><span class="p">(</span><span class="n">served_url</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">)</span>
                <span class="n">verify_url_part</span><span class="p">(</span><span class="n">served_url</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">)</span>

                <span class="n">display_url</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">proxied_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                    <span class="n">proxied_url</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">proxied_url</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">proxied_url</span><span class="o">.</span><span class="n">port</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">path</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">display_url</span> <span class="o">=</span> <span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">jupyter_dash</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">in_ipython</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dash is running on </span><span class="si">%s</span><span class="s2">://</span><span class="si">%s%s%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">display_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">extra_hot_reload_paths</span><span class="p">:</span>
            <span class="n">extra_files</span> <span class="o">=</span> <span class="n">flask_run_options</span><span class="p">[</span><span class="s2">&quot;extra_files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">extra_hot_reload_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                            <span class="n">extra_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">fn</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">extra_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">jupyter_dash</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">jupyter_mode</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">jupyter_width</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">jupyter_height</span><span class="p">,</span>
                <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
                <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
                <span class="n">server_url</span><span class="o">=</span><span class="n">jupyter_server_url</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="o">**</span><span class="n">flask_run_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enable_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_pages</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pages_folder</span><span class="p">:</span>
            <span class="n">_import_layouts_from_pages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pages_folder</span><span class="p">)</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">before_request</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">router</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">[</span><span class="s2">&quot;pages&quot;</span><span class="p">]:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_got_first_request</span><span class="p">[</span><span class="s2">&quot;pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;pathname_&quot;</span><span class="p">:</span> <span class="n">Input</span><span class="p">(</span><span class="n">_ID_LOCATION</span><span class="p">,</span> <span class="s2">&quot;pathname&quot;</span><span class="p">),</span>
                <span class="s2">&quot;search_&quot;</span><span class="p">:</span> <span class="n">Input</span><span class="p">(</span><span class="n">_ID_LOCATION</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routing_callback_inputs</span><span class="p">)</span>  <span class="c1"># type: ignore[reportCallIssue]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_async</span><span class="p">:</span>

                <span class="nd">@self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
                    <span class="n">Output</span><span class="p">(</span><span class="n">_ID_CONTENT</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
                    <span class="n">Output</span><span class="p">(</span><span class="n">_ID_STORE</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
                    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">pathname_</span><span class="p">,</span> <span class="n">search_</span><span class="p">,</span> <span class="o">**</span><span class="n">states</span><span class="p">):</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    Updates dash.page_container layout on page navigation.</span>
<span class="sd">                    Updates the stored page title which will trigger the clientside callback to update the app title</span>
<span class="sd">                    &quot;&quot;&quot;</span>

                    <span class="n">query_parameters</span> <span class="o">=</span> <span class="n">_parse_query_string</span><span class="p">(</span><span class="n">search_</span><span class="p">)</span>
                    <span class="n">page</span><span class="p">,</span> <span class="n">path_variables</span> <span class="o">=</span> <span class="n">_path_to_page</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">strip_relative_path</span><span class="p">(</span><span class="n">pathname_</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="c1"># get layout</span>
                    <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;not_found_404&quot;</span><span class="p">:</span>
                                <span class="n">layout</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>
                                <span class="n">title</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
                                <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;404 - Page not found&quot;</span><span class="p">)</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">layout</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">layout</span><span class="p">):</span>
                        <span class="n">layout</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_async_function</span><span class="p">(</span>
                            <span class="n">layout</span><span class="p">,</span>
                            <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="p">(</span><span class="n">path_variables</span> <span class="ow">or</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">query_parameters</span><span class="p">,</span> <span class="o">**</span><span class="n">states</span><span class="p">},</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_async_function</span><span class="p">(</span>
                            <span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">path_variables</span> <span class="ow">or</span> <span class="p">{})</span>
                        <span class="p">)</span>

                    <span class="k">return</span> <span class="n">layout</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span>

                <span class="n">_validate</span><span class="o">.</span><span class="n">check_for_duplicate_pathnames</span><span class="p">(</span><span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="p">)</span>
                <span class="n">_validate</span><span class="o">.</span><span class="n">validate_registry</span><span class="p">(</span><span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="p">)</span>

                <span class="c1"># Set validation_layout</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suppress_callback_exceptions</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">execute_async_function</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">])</span>
                            <span class="k">else</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                        <span class="p">]</span>
                        <span class="o">+</span> <span class="p">[</span>
                            <span class="c1"># pylint: disable=not-callable</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
                            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
                            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">_ID_CONTENT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;`dash.page_container` not found in the layout&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="nd">@self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
                    <span class="n">Output</span><span class="p">(</span><span class="n">_ID_CONTENT</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
                    <span class="n">Output</span><span class="p">(</span><span class="n">_ID_STORE</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
                    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">pathname_</span><span class="p">,</span> <span class="n">search_</span><span class="p">,</span> <span class="o">**</span><span class="n">states</span><span class="p">):</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    Updates dash.page_container layout on page navigation.</span>
<span class="sd">                    Updates the stored page title which will trigger the clientside callback to update the app title</span>
<span class="sd">                    &quot;&quot;&quot;</span>

                    <span class="n">query_parameters</span> <span class="o">=</span> <span class="n">_parse_query_string</span><span class="p">(</span><span class="n">search_</span><span class="p">)</span>
                    <span class="n">page</span><span class="p">,</span> <span class="n">path_variables</span> <span class="o">=</span> <span class="n">_path_to_page</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">strip_relative_path</span><span class="p">(</span><span class="n">pathname_</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="c1"># get layout</span>
                    <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="p">{}:</span>
                        <span class="k">for</span> <span class="n">module</span><span class="p">,</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;not_found_404&quot;</span><span class="p">:</span>
                                <span class="n">layout</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>
                                <span class="n">title</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
                                <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;404 - Page not found&quot;</span><span class="p">)</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">layout</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">layout</span><span class="p">):</span>
                        <span class="n">layout</span> <span class="o">=</span> <span class="n">layout</span><span class="p">(</span>
                            <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="p">(</span><span class="n">path_variables</span> <span class="ow">or</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">query_parameters</span><span class="p">,</span> <span class="o">**</span><span class="n">states</span><span class="p">}</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">path_variables</span> <span class="ow">or</span> <span class="p">{}))</span>

                    <span class="k">return</span> <span class="n">layout</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span>

                <span class="n">_validate</span><span class="o">.</span><span class="n">check_for_duplicate_pathnames</span><span class="p">(</span><span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="p">)</span>
                <span class="n">_validate</span><span class="o">.</span><span class="n">validate_registry</span><span class="p">(</span><span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="p">)</span>

                <span class="c1"># Set validation_layout</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">suppress_callback_exceptions</span><span class="p">:</span>
                    <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="c1"># pylint: disable=not-callable</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
                            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
                            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>
                        <span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]()</span>
                                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">])</span>
                                <span class="k">else</span> <span class="n">page</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">_pages</span><span class="o">.</span><span class="n">PAGE_REGISTRY</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                            <span class="p">]</span>
                            <span class="o">+</span> <span class="n">layout</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">_ID_CONTENT</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_layout</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;`dash.page_container` not found in the layout&quot;</span><span class="p">)</span>

            <span class="c1"># Update the page title on page navigation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clientside_callback</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                function(data) {{</span>
<span class="sd">                    document.title = data.title</span>
<span class="sd">                }}</span>
<span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">Output</span><span class="p">(</span><span class="n">_ID_DUMMY</span><span class="p">,</span> <span class="s2">&quot;children&quot;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">_ID_STORE</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method makes instances of Dash WSGI-compliant callables.</span>
<span class="sd">        It delegates the actual WSGI handling to the internal Flask app&#39;s</span>
<span class="sd">        __call__ method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kari Salokas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>